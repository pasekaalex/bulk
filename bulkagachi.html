<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BULKAGACHI - Virtual Pet</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 50%, #1a0a2e 100%);
            font-family: 'Press Start 2P', monospace;
            overflow-x: hidden;
            overflow-y: auto;
            width: 100vw;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }

        #game-container {
            width: min(90vw, 500px);
            height: min(90vh, 700px);
            background: #0d0d0d;
            border: 8px solid #9b30ff;
            border-radius: 30px;
            box-shadow: 0 0 40px rgba(155, 48, 255, 0.8), inset 0 0 30px rgba(155, 48, 255, 0.2);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        #title {
            background: linear-gradient(135deg, #9b30ff, #ff00ff);
            padding: 15px;
            text-align: center;
            color: #fff;
            font-size: clamp(0.8rem, 4vw, 1.2rem);
            text-shadow: 2px 2px 0 #000;
            border-bottom: 4px solid #ff00ff;
            flex-shrink: 0;
        }

        #scene-container {
            flex: 1;
            min-height: 0;
            position: relative;
            background: #1a1a1a;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        #stats {
            background: #0a0a0a;
            padding: 15px;
            border-top: 4px solid #9b30ff;
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-shrink: 0;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-label {
            color: #9b30ff;
            font-size: clamp(0.4rem, 2vw, 0.6rem);
            width: 80px;
            text-shadow: 0 0 5px #9b30ff;
        }

        .stat-bar-container {
            flex: 1;
            height: 20px;
            background: #1a1a1a;
            border: 2px solid #9b30ff;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .stat-bar {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.4rem, 1.5vw, 0.5rem);
            font-weight: bold;
            color: #000;
            text-shadow: 0 0 3px rgba(255,255,255,0.8);
        }

        .stat-bar.hunger {
            background: linear-gradient(90deg, #ff00ff, #9b30ff);
            box-shadow: 0 0 10px #ff00ff;
        }

        .stat-bar.happiness {
            background: linear-gradient(90deg, #ffd700, #ffff00);
            box-shadow: 0 0 10px #ffd700;
        }

        .stat-bar.cleanliness {
            background: linear-gradient(90deg, #00ffff, #0088ff);
            box-shadow: 0 0 10px #00ffff;
        }

        .stat-bar.low {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #actions {
            background: #0a0a0a;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            border-top: 2px solid #9b30ff;
        }

        .action-btn {
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 15px 10px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.5rem, 2vw, 0.7rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 0 4px 0 #4a0dad, 0 0 20px rgba(155, 48, 255, 0.5);
            transition: all 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .action-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #4a0dad, 0 0 10px rgba(155, 48, 255, 0.5);
        }

        .action-btn .emoji {
            font-size: clamp(1.5rem, 6vw, 2rem);
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        #mood-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #9b30ff;
            border-radius: 15px;
            padding: 10px 15px;
            color: #fff;
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            text-shadow: 0 0 5px #9b30ff;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #mood-emoji {
            font-size: clamp(1.5rem, 5vw, 2rem);
        }

        #message {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(155, 48, 255, 0.95);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 10px 20px;
            color: #fff;
            font-size: clamp(0.5rem, 2vw, 0.7rem);
            text-align: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            max-width: 80%;
            text-shadow: 2px 2px 0 #000;
        }

        #message.show {
            opacity: 1;
        }

        @media (max-width: 480px) {
            body {
                padding: 5px 0;
                overflow: hidden;
            }

            #game-container {
                width: 98vw;
                height: 98vh;
                max-height: 98vh;
                border-width: 4px;
                border-radius: 15px;
            }

            #title {
                padding: 8px;
                font-size: clamp(0.7rem, 3.5vw, 1rem);
            }

            #stats {
                padding: 8px;
                gap: 5px;
            }

            .stat-label {
                width: 50px;
                font-size: clamp(0.35rem, 1.8vw, 0.5rem);
            }

            .stat-bar-container {
                height: 16px;
            }

            #actions {
                padding: 8px;
                gap: 6px;
            }

            .action-btn {
                padding: 8px 4px;
                font-size: clamp(0.35rem, 1.8vw, 0.5rem);
            }

            #extras-menu-btn {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            #extras-panel {
                max-height: 60vh;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .bounce {
            animation: bounce 0.5s ease;
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        @keyframes jump {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-30px) scale(1.1); }
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            animation: particleFade 1s ease-out forwards;
        }

        @keyframes particleFade {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        #home-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #9b30ff;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 10;
            transition: all 0.3s;
            text-shadow: 0 0 5px #9b30ff;
        }

        #home-btn:hover {
            background: rgba(155, 48, 255, 0.3);
            transform: scale(1.05);
        }

        #age-counter {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 8px 12px;
            color: #ffd700;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            text-shadow: 0 0 5px #ffd700;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }

        .floating-emoji {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            z-index: 50;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0.5);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(1.2);
            }
        }

        #combo-indicator {
            position: absolute;
            top: 60px;
            right: 10px;
            background: rgba(255, 215, 0, 0.95);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 8px 15px;
            color: #000;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
            z-index: 10;
            font-weight: bold;
            display: none;
            animation: comboPulse 0.5s ease-in-out infinite;
        }

        @keyframes comboPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        #growth-stage {
            position: absolute;
            top: 60px;
            left: 10px;
            background: rgba(155, 48, 255, 0.95);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 8px 12px;
            color: #fff;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            text-shadow: 0 0 5px #9b30ff;
            z-index: 10;
        }

        #minigame-btn {
            position: absolute;
            bottom: 60px;
            right: 10px;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border: 3px solid #ffff00;
            border-radius: 15px;
            padding: 10px 15px;
            color: #000;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
            z-index: 10;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 0 #cc6600, 0 0 20px rgba(255, 215, 0, 0.5);
        }

        #minigame-btn:hover {
            transform: scale(1.05);
        }

        #minigame-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #cc6600, 0 0 10px rgba(255, 215, 0, 0.5);
        }

        #achievements-btn {
            position: absolute;
            bottom: 60px;
            left: 10px;
            background: linear-gradient(135deg, #ffd700, #ff00ff);
            border: 3px solid #ffff00;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #6a0dad, 0 0 20px rgba(255, 215, 0, 0.5);
        }

        #achievements-btn:hover {
            transform: scale(1.05);
        }

        #achievements-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #6a0dad, 0 0 10px rgba(255, 215, 0, 0.5);
        }

        #settings-btn {
            position: absolute;
            top: 10px;
            right: 70px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #9b30ff;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }

        #settings-btn:hover {
            background: rgba(155, 48, 255, 0.3);
            transform: scale(1.05);
        }

        #food-menu {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
            margin-bottom: 10px;
        }

        #food-menu.active {
            display: flex;
        }

        .food-item {
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 8px 12px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .food-item:hover {
            background: linear-gradient(135deg, #ff00ff, #9b30ff);
            transform: scale(1.05);
        }

        .food-emoji {
            font-size: 1.5rem;
        }

        #weather-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 4;
        }

        .raindrop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, rgba(135, 206, 250, 0.6));
            animation: rain 1s linear infinite;
        }

        @keyframes rain {
            0% {
                transform: translateY(-100px);
                opacity: 1;
            }
            100% {
                transform: translateY(500px);
                opacity: 0;
            }
        }

        .snowflake {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: snow 4s linear infinite;
            opacity: 0.8;
        }

        @keyframes snow {
            0% {
                transform: translateY(-100px) translateX(0);
            }
            100% {
                transform: translateY(500px) translateX(50px);
            }
        }

        #settings-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            gap: 20px;
        }

        #settings-modal.active {
            display: flex;
        }

        .setting-row {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #fff;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
        }

        .toggle-btn {
            width: 60px;
            height: 30px;
            background: #555;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-btn.active {
            background: #9b30ff;
        }

        .toggle-slider {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 3px;
            left: 3px;
            transition: left 0.3s;
        }

        .toggle-btn.active .toggle-slider {
            left: 33px;
        }

        #event-notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 215, 0, 0.98);
            border: 4px solid #ff00ff;
            border-radius: 20px;
            padding: 20px;
            color: #000;
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            text-align: center;
            z-index: 200;
            display: none;
            max-width: 80%;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            animation: eventPop 0.3s ease-out;
        }

        @keyframes eventPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        #event-notification.active {
            display: block;
        }

        #memory-game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 20px auto;
        }

        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 3px solid #ff00ff;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            transition: all 0.3s;
            position: relative;
        }

        .memory-card.flipped {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
        }

        .memory-card.matched {
            background: linear-gradient(135deg, #00ff00, #00aa00);
            border-color: #00ff00;
        }

        .memory-card .card-back {
            display: block;
        }

        .memory-card .card-front {
            display: none;
        }

        .memory-card.flipped .card-back {
            display: none;
        }

        .memory-card.flipped .card-front {
            display: block;
        }

        /* Dream System */
        #dream-btn {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4169e1, #9370db);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 12px 25px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.5rem, 2vw, 0.7rem);
            cursor: pointer;
            z-index: 10;
            display: none;
            animation: dreamPulse 2s ease-in-out infinite;
            text-shadow: 0 0 10px #fff;
            box-shadow: 0 0 30px rgba(65, 105, 225, 0.8);
        }

        @keyframes dreamPulse {
            0%, 100% { transform: translateX(-50%) scale(1); box-shadow: 0 0 30px rgba(65, 105, 225, 0.8); }
            50% { transform: translateX(-50%) scale(1.05); box-shadow: 0 0 50px rgba(147, 112, 219, 1); }
        }

        #dream-btn.visible {
            display: block;
        }

        .dream-particle {
            position: absolute;
            pointer-events: none;
            z-index: 6;
            font-size: 1.5rem;
            animation: dreamFloat 6s ease-in-out infinite;
        }

        @keyframes dreamFloat {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.4; }
            50% { transform: translateY(-40px) scale(1.2); opacity: 0.8; }
        }

        /* Level System */
        #level-display {
            position: absolute;
            top: 110px;
            left: 10px;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border: 3px solid #fff;
            border-radius: 12px;
            padding: 8px 12px;
            color: #000;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            font-weight: bold;
            z-index: 10;
            text-shadow: 0 0 3px rgba(255,255,255,0.8);
        }

        #xp-bar-container {
            width: 60px;
            height: 8px;
            background: rgba(0,0,0,0.5);
            border-radius: 4px;
            margin-top: 4px;
            overflow: hidden;
        }

        #xp-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #7fff00);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Streak Display */
        #streak-display {
            position: absolute;
            top: 110px;
            right: 10px;
            background: linear-gradient(135deg, #ff4500, #ff6347);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            z-index: 10;
            text-shadow: 2px 2px 0 #000;
            display: none;
        }

        #streak-display.visible {
            display: block;
        }

        /* Thought Bubble */
        #thought-bubble {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #9b30ff;
            border-radius: 20px;
            padding: 10px 15px;
            color: #333;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            z-index: 15;
            max-width: 70%;
            text-align: center;
            display: none;
            animation: thoughtPop 0.3s ease-out;
        }

        #thought-bubble::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: #fff;
        }

        @keyframes thoughtPop {
            0% { transform: translateX(-50%) scale(0); opacity: 0; }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }

        #thought-bubble.visible {
            display: block;
        }

        /* Background Themes */
        .theme-default { background: #1a1a1a; }
        .theme-sunset { background: linear-gradient(180deg, #ff7e5f 0%, #feb47b 50%, #1a1a1a 100%); }
        .theme-ocean { background: linear-gradient(180deg, #2193b0 0%, #6dd5ed 50%, #1a1a1a 100%); }
        .theme-forest { background: linear-gradient(180deg, #134e5e 0%, #71b280 50%, #1a1a1a 100%); }
        .theme-space { background: linear-gradient(180deg, #0f0c29 0%, #302b63 50%, #24243e 100%); }
        .theme-candy { background: linear-gradient(180deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%); }

        /* Theme Selector */
        #theme-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #fff;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-btn.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .theme-btn.locked::after {
            content: 'ðŸ”’';
            position: absolute;
        }

        .theme-btn.selected {
            border-color: #ffd700;
            box-shadow: 0 0 15px #ffd700;
        }

        /* Needs Indicators */
        #needs-container {
            position: absolute;
            top: 160px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 20;
        }

        .need-icon {
            font-size: 1.5rem;
            animation: needBounce 1s ease-in-out infinite;
            display: none;
            filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.8));
        }

        .need-icon.visible {
            display: block;
        }

        @keyframes needBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Floating ZZZ during sleep */
        .sleep-zzz {
            position: absolute;
            font-size: 2rem;
            color: #9b30ff;
            text-shadow: 0 0 10px #9b30ff;
            animation: zzzFloat 3s ease-in-out infinite;
            pointer-events: none;
            z-index: 8;
        }

        @keyframes zzzFloat {
            0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; }
            50% { transform: translateY(-50px) translateX(20px) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) translateX(40px) scale(0.8); opacity: 0; }
        }

        /* Emotion Indicators */
        .emotion-indicator {
            position: absolute;
            font-size: 1.2rem;
            pointer-events: none;
            z-index: 25;
            animation: emotionFloat 2s ease-in-out infinite;
        }

        @keyframes emotionFloat {
            0%, 100% { transform: translateY(0); opacity: 0.8; }
            50% { transform: translateY(-5px); opacity: 1; }
        }

        .tear {
            color: #00bfff;
            left: 35%;
            top: 40%;
        }

        .sweat {
            color: #87ceeb;
            right: 35%;
            top: 38%;
        }

        /* Perfect Halo */
        #perfect-halo {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 40px;
            border: 4px solid #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, inset 0 0 20px rgba(255, 215, 0, 0.3);
            display: none;
            z-index: 6;
            animation: haloGlow 2s ease-in-out infinite;
        }

        #perfect-halo.visible {
            display: block;
        }

        @keyframes haloGlow {
            0%, 100% { box-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700; opacity: 0.8; }
            50% { box-shadow: 0 0 30px #ffd700, 0 0 60px #ffd700; opacity: 1; }
        }

        /* Background Stars */
        .bg-star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        /* Coin Display */
        #coin-display {
            position: absolute;
            top: 10px;
            left: 120px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border: 3px solid #fff;
            border-radius: 20px;
            padding: 8px 15px;
            color: #000;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
            font-weight: bold;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        #coin-display .coin-icon {
            font-size: 1.2rem;
        }

        /* Shop Button */
        #shop-btn {
            position: absolute;
            bottom: 100px;
            left: 10px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #c71585, 0 0 20px rgba(255, 105, 180, 0.5);
        }

        #shop-btn:hover {
            transform: scale(1.05);
        }

        #shop-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #c71585, 0 0 10px rgba(255, 105, 180, 0.5);
        }

        /* Shop Modal */
        #shop-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        #shop-modal.active {
            display: flex;
        }

        .shop-item {
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 15px;
            margin: 8px 0;
            width: 90%;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .shop-item:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        .shop-item.owned {
            background: linear-gradient(135deg, #228b22, #32cd32);
            border-color: #00ff00;
        }

        .shop-item.equipped {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border-color: #fff;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
        }

        .shop-item-icon {
            font-size: 2rem;
        }

        .shop-item-info {
            flex: 1;
        }

        .shop-item-name {
            color: #fff;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
            margin-bottom: 4px;
        }

        .shop-item-price {
            color: #ffd700;
            font-size: clamp(0.4rem, 1.5vw, 0.5rem);
        }

        /* Accessory Display */
        #accessory-display {
            position: absolute;
            top: 22%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            z-index: 7;
            pointer-events: none;
            animation: accessoryBob 2s ease-in-out infinite;
        }

        @keyframes accessoryBob {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }

        /* Poop System */
        #poop-container {
            position: absolute;
            bottom: 18%;
            left: 20%;
            display: flex;
            gap: 8px;
            z-index: 5;
            flex-wrap: wrap;
            max-width: 60%;
        }

        .poop {
            font-size: 1.5rem;
            animation: poopAppear 0.5s ease-out, poopWiggle 2s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .poop.tiny {
            font-size: 1rem;
        }

        .poop.golden {
            font-size: 1.8rem;
            filter: drop-shadow(0 0 10px gold) drop-shadow(0 0 20px gold);
            animation: poopAppear 0.5s ease-out, goldenPoopGlow 1s ease-in-out infinite;
        }

        .poop:hover {
            transform: scale(1.3);
        }

        @keyframes poopAppear {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes poopWiggle {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes goldenPoopGlow {
            0%, 100% { filter: drop-shadow(0 0 10px gold) drop-shadow(0 0 20px gold); transform: scale(1); }
            50% { filter: drop-shadow(0 0 20px gold) drop-shadow(0 0 40px gold); transform: scale(1.1); }
        }

        /* Poop Warning */
        #poop-warning {
            position: absolute;
            top: 28%;
            right: 30%;
            font-size: 1.5rem;
            z-index: 25;
            display: none;
            animation: warningPulse 0.5s ease-in-out infinite;
        }

        #poop-warning.visible {
            display: block;
        }

        @keyframes warningPulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.3); opacity: 1; }
        }

        /* Buzzing Flies */
        .fly {
            position: absolute;
            font-size: 0.8rem;
            pointer-events: none;
            z-index: 6;
            animation: flyBuzz 1s ease-in-out infinite;
        }

        @keyframes flyBuzz {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(10px, -8px) rotate(15deg); }
            50% { transform: translate(-5px, -12px) rotate(-10deg); }
            75% { transform: translate(-10px, -5px) rotate(10deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        /* Stink Lines */
        .stink-lines {
            position: absolute;
            bottom: 25%;
            left: 30%;
            font-size: 1rem;
            color: #90ee90;
            opacity: 0.7;
            z-index: 4;
            animation: stinkFloat 1.5s ease-in-out infinite;
            display: none;
        }

        .stink-lines.visible {
            display: block;
        }

        @keyframes stinkFloat {
            0%, 100% { transform: translateY(0) rotate(-10deg); opacity: 0.3; }
            50% { transform: translateY(-15px) rotate(10deg); opacity: 0.8; }
        }

        /* Stink Cloud */
        .stink-cloud {
            position: absolute;
            font-size: 1.2rem;
            pointer-events: none;
            z-index: 4;
            animation: stinkCloudFloat 2s ease-out forwards;
            opacity: 0.6;
        }

        @keyframes stinkCloudFloat {
            0% { transform: translateY(0) scale(0.5); opacity: 0.8; }
            100% { transform: translateY(-60px) scale(1.5); opacity: 0; }
        }

        /* Scoop Animation */
        .scoop-effect {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            z-index: 100;
            animation: scoopAnim 0.5s ease-out forwards;
        }

        @keyframes scoopAnim {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            50% { transform: translateY(-20px) rotate(-30deg); opacity: 1; }
            100% { transform: translateY(-50px) rotate(-60deg); opacity: 0; }
        }

        /* Embarrassed Face */
        #embarrassed-face {
            position: absolute;
            top: 35%;
            left: 55%;
            font-size: 1.5rem;
            z-index: 26;
            display: none;
            animation: embarrassedBounce 0.3s ease-in-out;
        }

        #embarrassed-face.visible {
            display: block;
        }

        @keyframes embarrassedBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Poop Urgency Meter */
        #poop-meter {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 5px 10px;
            z-index: 10;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }

        #poop-meter.visible {
            display: flex;
        }

        #poop-meter-label {
            color: #8b4513;
            font-size: clamp(0.3rem, 1.5vw, 0.4rem);
        }

        #poop-meter-bar {
            width: 50px;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        #poop-meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b4513, #daa520);
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Sickness System */
        #sick-indicator {
            position: absolute;
            top: 32%;
            right: 35%;
            font-size: 1.5rem;
            z-index: 26;
            display: none;
            animation: sickPulse 1s ease-in-out infinite;
        }

        #sick-indicator.visible {
            display: block;
        }

        @keyframes sickPulse {
            0%, 100% { transform: scale(1) rotate(-5deg); opacity: 0.8; }
            50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
        }

        #medicine-btn {
            position: absolute;
            bottom: 140px;
            right: 10px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            border: 3px solid #fff;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            display: none;
            animation: medicineGlow 1s ease-in-out infinite;
            box-shadow: 0 4px 0 #cc4444, 0 0 20px rgba(255, 107, 107, 0.5);
        }

        #medicine-btn.visible {
            display: block;
        }

        @keyframes medicineGlow {
            0%, 100% { box-shadow: 0 4px 0 #cc4444, 0 0 20px rgba(255, 107, 107, 0.5); }
            50% { box-shadow: 0 4px 0 #cc4444, 0 0 40px rgba(255, 107, 107, 0.8); }
        }

        /* Toys System */
        #toys-btn {
            position: absolute;
            bottom: 140px;
            left: 10px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #c71585, 0 0 20px rgba(255, 105, 180, 0.5);
        }

        #toys-btn:hover {
            transform: scale(1.05);
        }

        #toys-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        #toys-modal.active {
            display: flex;
        }

        .toy-item {
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 15px;
            margin: 8px 0;
            width: 90%;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toy-item:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        .toy-item.owned {
            background: linear-gradient(135deg, #228b22, #32cd32);
            border-color: #00ff00;
        }

        .active-toy {
            position: absolute;
            font-size: 2rem;
            z-index: 7;
            animation: toyBounce 1s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes toyBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        /* Visitor System */
        #visitor-container {
            position: absolute;
            left: 5%;
            bottom: 25%;
            z-index: 8;
            display: none;
        }

        #visitor-container.visible {
            display: block;
        }

        .visitor {
            font-size: 2.5rem;
            animation: visitorEnter 0.5s ease-out, visitorIdle 2s ease-in-out infinite 0.5s;
        }

        @keyframes visitorEnter {
            0% { transform: translateX(-100px) scale(0); opacity: 0; }
            100% { transform: translateX(0) scale(1); opacity: 1; }
        }

        @keyframes visitorIdle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .visitor-speech {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 2px solid #9b30ff;
            border-radius: 10px;
            padding: 5px 10px;
            font-size: clamp(0.4rem, 1.5vw, 0.5rem);
            color: #333;
            white-space: nowrap;
            animation: speechPop 0.3s ease-out;
        }

        @keyframes speechPop {
            0% { transform: translateX(-50%) scale(0); }
            100% { transform: translateX(-50%) scale(1); }
        }

        /* Tricks System */
        #tricks-btn {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #9932cc, #8b008b);
            border: 3px solid #dda0dd;
            border-radius: 15px;
            padding: 8px 15px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #4b0082, 0 0 20px rgba(153, 50, 204, 0.5);
        }

        #tricks-btn:hover {
            transform: translateX(-50%) scale(1.05);
        }

        #tricks-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        #tricks-modal.active {
            display: flex;
        }

        .trick-item {
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 3px solid #ff00ff;
            border-radius: 15px;
            padding: 15px;
            margin: 8px 0;
            width: 90%;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .trick-item:hover {
            transform: scale(1.02);
        }

        .trick-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .trick-item.learned {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border-color: #fff;
        }

        /* Fortune Cookie */
        #fortune-btn {
            position: absolute;
            top: 60px;
            left: 10px;
            background: linear-gradient(135deg, #daa520, #b8860b);
            border: 3px solid #ffd700;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #8b6914, 0 0 15px rgba(218, 165, 32, 0.5);
        }

        #fortune-btn:hover {
            transform: scale(1.1) rotate(10deg);
        }

        #fortune-btn.claimed {
            opacity: 0.4;
            cursor: not-allowed;
        }

        #fortune-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #fff8dc, #faebd7);
            border: 4px solid #daa520;
            border-radius: 20px;
            padding: 25px;
            color: #8b4513;
            font-size: clamp(0.5rem, 2vw, 0.7rem);
            text-align: center;
            z-index: 200;
            display: none;
            max-width: 80%;
            box-shadow: 0 0 40px rgba(218, 165, 32, 0.8);
            animation: fortunePop 0.4s ease-out;
        }

        #fortune-modal.active {
            display: block;
        }

        @keyframes fortunePop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-20deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }

        .fortune-text {
            font-style: italic;
            margin: 15px 0;
            line-height: 1.6;
        }

        .fortune-lucky {
            color: #ff6347;
            margin-top: 10px;
        }

        /* Extras Menu Button - Clean Mobile UI */
        #extras-menu-btn {
            position: absolute;
            top: 10px;
            right: 60px;
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 3px solid #ff00ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(155, 48, 255, 0.5);
        }

        #extras-menu-btn:hover {
            transform: scale(1.1);
        }

        #extras-menu-btn.active {
            background: linear-gradient(135deg, #ff00ff, #ff69b4);
        }

        /* Extras Panel */
        #extras-panel {
            position: absolute;
            top: 60px;
            right: 10px;
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #9b30ff;
            border-radius: 15px;
            padding: 10px;
            z-index: 19;
            display: none;
            flex-direction: column;
            gap: 8px;
            max-height: 70%;
            overflow-y: auto;
        }

        #extras-panel.active {
            display: flex;
        }

        .extras-btn {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #9b30ff;
            border-radius: 10px;
            padding: 10px 15px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.35rem, 1.5vw, 0.45rem);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .extras-btn:hover {
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            transform: scale(1.02);
        }

        .extras-btn-icon {
            font-size: 1.2rem;
        }

        /* Hide buttons that are now in extras menu */
        #music-btn, #photo-btn, #stats-btn, #quests-btn, #color-btn, #fortune-btn,
        #achievements-btn, #settings-btn, #toys-btn, #tricks-btn {
            display: none;
        }

        /* Photo Mode */

        #photo-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 200;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #photo-modal.active {
            display: flex;
        }

        #photo-preview {
            border: 5px solid #ffd700;
            border-radius: 15px;
            margin: 15px 0;
            max-width: 90%;
            max-height: 50%;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
        }

        .filter-btn {
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 8px 15px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.3rem, 1.5vw, 0.4rem);
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            transform: scale(1.05);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            border-color: #fff;
        }

        /* Stats Page */
        #stats-btn {
            position: absolute;
            top: 60px;
            right: 10px;
            background: linear-gradient(135deg, #20b2aa, #008b8b);
            border: 3px solid #7fffd4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(32, 178, 170, 0.5);
        }

        #stats-btn:hover {
            transform: scale(1.1);
        }

        #stats-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        #stats-modal.active {
            display: flex;
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 3px solid #9b30ff;
            border-radius: 15px;
            padding: 15px;
            margin: 8px 0;
            width: 90%;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-card-icon {
            font-size: 2rem;
        }

        .stat-card-info {
            flex: 1;
        }

        .stat-card-label {
            color: #9b30ff;
            font-size: clamp(0.4rem, 1.5vw, 0.5rem);
        }

        .stat-card-value {
            color: #ffd700;
            font-size: clamp(0.6rem, 2vw, 0.7rem);
            margin-top: 3px;
        }

        /* Daily Quests */
        #quests-btn {
            position: absolute;
            top: 110px;
            right: 10px;
            background: linear-gradient(135deg, #ff8c00, #ff6347);
            border: 3px solid #ffd700;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.5);
        }

        #quests-btn:hover {
            transform: scale(1.1);
        }

        #quests-btn.has-complete {
            animation: questGlow 1s ease-in-out infinite;
        }

        @keyframes questGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 140, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 1); }
        }

        #quests-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        #quests-modal.active {
            display: flex;
        }

        .quest-item {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 3px solid #ff8c00;
            border-radius: 15px;
            padding: 15px;
            margin: 8px 0;
            width: 90%;
            max-width: 350px;
        }

        .quest-item.completed {
            border-color: #00ff00;
            background: linear-gradient(135deg, #0a3d0a, #1a4d1a);
        }

        .quest-item.claimed {
            opacity: 0.5;
            border-color: #666;
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .quest-title {
            color: #ffd700;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
        }

        .quest-reward {
            color: #ff8c00;
            font-size: clamp(0.4rem, 1.5vw, 0.5rem);
        }

        .quest-progress {
            background: #333;
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
            margin-top: 8px;
        }

        .quest-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff8c00, #ffd700);
            border-radius: 10px;
            transition: width 0.3s;
        }

        /* Color Picker */
        #color-btn {
            position: absolute;
            top: 160px;
            right: 10px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: 3px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.5);
        }

        #color-btn:hover {
            transform: scale(1.1);
        }

        #color-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        #color-modal.active {
            display: flex;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 4px solid #fff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.15);
        }

        .color-option.selected {
            box-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700;
        }

        .color-option.locked {
            opacity: 0.6;
            border-style: dashed;
        }

        .color-option.locked:hover {
            border-color: #ffd700;
        }

        /* Bath Animation Overlay */
        #bath-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(0, 191, 255, 0.3) 0%, rgba(0, 191, 255, 0.6) 100%);
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        #bath-overlay.active {
            display: flex;
            animation: bathFade 0.5s ease-out;
        }

        @keyframes bathFade {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .bubble {
            position: absolute;
            font-size: 1.5rem;
            animation: bubbleFloat 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes bubbleFloat {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            50% { transform: translateY(-30px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-60px) scale(0.8); opacity: 0; }
        }

        .splash {
            position: absolute;
            font-size: 2rem;
            animation: splashPop 0.5s ease-out forwards;
            pointer-events: none;
        }

        @keyframes splashPop {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        /* Memory Game Modal */
        #memory-game-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 160;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            overflow-y: auto;
        }

        #memory-game-modal.active {
            display: flex;
        }

        #memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-width: 300px;
            margin: 10px 0;
        }

        .memory-card {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #9b30ff, #6a0dad);
            border: 3px solid #ff00ff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #4a0080;
        }

        .memory-card:hover {
            transform: translateY(-2px);
        }

        .memory-card.flipped {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border-color: #fff;
        }

        .memory-card.matched {
            background: linear-gradient(135deg, #00ff00, #00cc00);
            border-color: #90ee90;
            animation: matchPulse 0.5s ease;
        }

        @keyframes matchPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Mood Indicator */
        #mood-indicator {
            position: absolute;
            top: 50px;
            left: 10px;
            font-size: 1.8rem;
            z-index: 15;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
            transition: all 0.5s;
        }

        /* Bath Bubbles Container */
        #bath-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 51;
            overflow: hidden;
        }

        .bath-bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9), rgba(135, 206, 250, 0.5));
            animation: bathBubbleRise 3s ease-in-out forwards;
            box-shadow: inset -2px -2px 4px rgba(0, 0, 0, 0.1);
        }

        @keyframes bathBubbleRise {
            0% { transform: translateY(100%) scale(0); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(-100vh) scale(1.5); opacity: 0; }
        }

        /* Sparkle effect */
        .sparkle {
            position: absolute;
            font-size: 1rem;
            animation: sparkleAnim 1s ease-out forwards;
            pointer-events: none;
            z-index: 52;
        }

        @keyframes sparkleAnim {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(1.5) rotate(180deg); opacity: 0; }
        }

        /* Dance Button */
        #dance-btn {
            position: absolute;
            bottom: 100px;
            right: 10px;
            background: linear-gradient(135deg, #00ced1, #20b2aa);
            border: 3px solid #7fffd4;
            border-radius: 12px;
            padding: 8px 12px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.4rem, 1.8vw, 0.5rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #008b8b, 0 0 20px rgba(0, 206, 209, 0.5);
        }

        #dance-btn:hover {
            transform: scale(1.05);
        }

        #dance-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #008b8b, 0 0 10px rgba(0, 206, 209, 0.5);
        }

        /* Tickle Effect */
        .tickle-text {
            position: absolute;
            font-size: 1rem;
            color: #ff69b4;
            text-shadow: 0 0 10px #ff69b4;
            pointer-events: none;
            z-index: 100;
            animation: tickleFloat 1s ease-out forwards;
        }

        @keyframes tickleFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(0.5); opacity: 0; }
        }

        /* Flying Coin Animation */
        .flying-coin {
            position: absolute;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 100;
            animation: coinFly 1s ease-out forwards;
        }

        @keyframes coinFly {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0.3); opacity: 0; }
        }

        /* Aura Effect */
        #bulk-aura {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;
            opacity: 0;
            transition: all 0.5s;
        }

        #bulk-aura.happy {
            opacity: 0.4;
            background: radial-gradient(circle, rgba(155, 48, 255, 0.6) 0%, transparent 70%);
            animation: auraPulse 2s ease-in-out infinite;
        }

        #bulk-aura.perfect {
            opacity: 0.6;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.8) 0%, rgba(255, 0, 255, 0.4) 50%, transparent 70%);
            animation: auraRainbow 3s ease-in-out infinite;
        }

        #bulk-aura.sad {
            opacity: 0.3;
            background: radial-gradient(circle, rgba(100, 100, 150, 0.4) 0%, transparent 70%);
        }

        @keyframes auraPulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }

        @keyframes auraRainbow {
            0%, 100% { transform: translateX(-50%) scale(1); filter: hue-rotate(0deg); }
            50% { transform: translateX(-50%) scale(1.2); filter: hue-rotate(180deg); }
        }

        /* Sparkle Trail */
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 50;
            animation: sparkleAnim 0.8s ease-out forwards;
        }

        @keyframes sparkleAnim {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            100% { transform: scale(0) rotate(180deg); opacity: 0; }
        }

        /* Hunger Rumble Effect */
        .rumble-lines {
            position: absolute;
            bottom: 35%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            color: #ff6b6b;
            display: none;
            z-index: 25;
            animation: rumble 0.5s ease-in-out infinite;
        }

        .rumble-lines.visible {
            display: block;
        }

        @keyframes rumble {
            0%, 100% { transform: translateX(-50%) translateX(-3px); }
            50% { transform: translateX(-50%) translateX(3px); }
        }

        /* Floating Hearts when Happy */
        .floating-heart {
            position: absolute;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 30;
            animation: heartFloat 3s ease-out forwards;
        }

        @keyframes heartFloat {
            0% { transform: translateY(0) scale(0); opacity: 1; }
            50% { transform: translateY(-80px) scale(1.2); opacity: 0.8; }
            100% { transform: translateY(-150px) scale(0.5); opacity: 0; }
        }

        .ambient-particle {
            position: absolute;
            pointer-events: none;
            z-index: 3;
            animation: floatAmbient 8s ease-in-out infinite;
            font-size: 1.5rem;
        }

        @keyframes floatAmbient {
            0%, 100% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0.6;
            }
            25% {
                transform: translateY(-30px) translateX(20px) rotate(90deg);
                opacity: 0.8;
            }
            50% {
                transform: translateY(-60px) translateX(-20px) rotate(180deg);
                opacity: 0.6;
            }
            75% {
                transform: translateY(-30px) translateX(20px) rotate(270deg);
                opacity: 0.8;
            }
        }

        #minigame-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 20px;
        }

        #minigame-modal.active {
            display: flex;
        }

        .game-target {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ff00ff, #ffd700);
            border: 4px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            position: absolute;
            transition: all 0.2s;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
            animation: targetPulse 0.5s ease-in-out infinite;
        }

        @keyframes targetPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .game-target:hover {
            transform: scale(1.2);
        }

        #achievements-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 150;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        #achievements-modal.active {
            display: flex;
        }

        .achievement {
            background: rgba(155, 48, 255, 0.3);
            border: 3px solid #9b30ff;
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0;
            width: 90%;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .achievement.unlocked {
            background: rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .achievement-icon {
            font-size: 2rem;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-title {
            color: #ffd700;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
            margin-bottom: 4px;
        }

        .achievement-desc {
            color: #9b30ff;
            font-size: clamp(0.4rem, 1.5vw, 0.5rem);
        }

        .close-modal-btn {
            background: linear-gradient(135deg, #ff00ff, #9b30ff);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 12px 24px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.5rem, 2vw, 0.6rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            margin-top: 15px;
        }

        .sleep-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 20, 0.7);
            z-index: 5;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }

        .sleep-overlay.active {
            display: flex;
        }

        #revival-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 200;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        #revival-screen.active {
            display: flex;
        }

        .revival-btn {
            background: linear-gradient(135deg, #ff00ff, #9b30ff);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 15px 30px;
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            cursor: pointer;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 0 4px 0 #6a0dad, 0 0 20px rgba(255, 0, 255, 0.5);
            transition: all 0.1s;
        }

        .revival-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #6a0dad, 0 0 10px rgba(255, 0, 255, 0.5);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="title">ðŸŽ® BULKAGACHI ðŸŽ®</div>

        <div id="scene-container">
            <a href="index.html" id="home-btn">
                <span>ðŸ </span>
                <span>HOME</span>
            </a>
            <button id="settings-btn" onclick="showSettings()">âš™ï¸</button>
            <div id="mood-indicator">
                <span id="mood-emoji">ðŸ˜Š</span>
                <span id="mood-text">HAPPY</span>
            </div>
            <div id="weather-effect"></div>
            <div id="coin-display">
                <span class="coin-icon">ðŸª™</span>
                <span id="coin-count">0</span>
            </div>
            <div id="accessory-display"></div>
            <div id="poop-container"></div>
            <div id="poop-warning">ðŸ˜£</div>
            <div id="embarrassed-face">ðŸ˜³</div>
            <div id="flies-container"></div>
            <div class="stink-lines" id="stink-lines">~ðŸ’¨~</div>
            <div id="poop-meter">
                <span id="poop-meter-label">ðŸ’© URGENCY</span>
                <div id="poop-meter-bar">
                    <div id="poop-meter-fill" style="width: 0%"></div>
                </div>
            </div>
            <div id="bulk-aura"></div>
            <div id="perfect-halo"></div>
            <div id="needs-container">
                <span class="need-icon" id="need-hunger">ðŸ´</span>
                <span class="need-icon" id="need-happiness">ðŸ’”</span>
                <span class="need-icon" id="need-clean">ðŸ§¼</span>
            </div>
            <div class="rumble-lines" id="rumble-lines">ã€°ï¸ã€°ï¸ã€°ï¸</div>
            <div id="combo-indicator">ðŸ”¥ COMBO x<span id="combo-count">0</span></div>
            <div id="growth-stage">BABY ðŸ¼</div>
            <div id="level-display">
                <span>LV <span id="level-num">1</span></span>
                <div id="xp-bar-container">
                    <div id="xp-bar" style="width: 0%"></div>
                </div>
            </div>
            <div id="streak-display">ðŸ”¥ <span id="streak-num">0</span> DAY STREAK</div>
            <div id="age-counter">
                <span>AGE</span>
                <span id="age-display">0d 0h</span>
            </div>
            <button id="minigame-btn" onclick="startMiniGame()">ðŸŽ¯ PLAY!</button>
            <button id="achievements-btn" onclick="showAchievements()">ðŸ†</button>
            <button id="shop-btn" onclick="showShop()">ðŸ›’ SHOP</button>
            <button id="dance-btn" onclick="makeBulkDance()">ðŸ’ƒ DANCE</button>
            <button id="toys-btn" onclick="showToys()">ðŸ§¸ TOYS</button>
            <button id="medicine-btn" onclick="giveMedicine()">ðŸ’Š MEDICINE</button>
            <button id="tricks-btn" onclick="showTricks()">ðŸŽª TRICKS</button>
            <button id="extras-menu-btn" onclick="toggleExtrasMenu()">âœ¨</button>
            <div id="extras-panel">
                <button class="extras-btn" onclick="giveBath(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸ›</span> BATH</button>
                <button class="extras-btn" onclick="toggleMusic(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸŽµ</span> MUSIC</button>
                <button class="extras-btn" onclick="openFortune(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸ¥ </span> FORTUNE</button>
                <button class="extras-btn" onclick="showQuests(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸ“œ</span> QUESTS</button>
                <button class="extras-btn" onclick="showStats(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸ“Š</span> STATS</button>
                <button class="extras-btn" onclick="showColorPicker(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸŽ¨</span> COLORS</button>
                <button class="extras-btn" onclick="showToys(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸ§¸</span> TOYS</button>
                <button class="extras-btn" onclick="showTricks(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸŽª</span> TRICKS</button>
                <button class="extras-btn" onclick="playMemoryGame(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸ§ </span> MEMORY</button>
                <button class="extras-btn" onclick="showAchievements(); toggleExtrasMenu();"><span class="extras-btn-icon">ðŸ†</span> ACHIEVEMENTS</button>
                <button class="extras-btn" onclick="showSettings(); toggleExtrasMenu();"><span class="extras-btn-icon">âš™ï¸</span> SETTINGS</button>
            </div>
            <button id="medicine-btn" onclick="giveMedicine()">ðŸ’Š</button>
            <div id="sick-indicator">ðŸ¤’</div>
            <div id="visitor-container"></div>
            <div id="active-toy-display"></div>
            <div id="bath-overlay"></div>
            <div id="thought-bubble"></div>
            <div class="sleep-overlay" id="sleep-overlay">
                ðŸ’¤
                <button id="dream-btn" onclick="giveDream()">ðŸŒ™ SWEET DREAMS</button>
            </div>
            <div id="revival-screen">
                <div style="font-size: clamp(1.5rem, 5vw, 3rem); text-align: center;">ðŸ˜­</div>
                <div style="font-size: clamp(0.6rem, 2.5vw, 1rem); color: #ff00ff; text-align: center; max-width: 80%;">BULK FAINTED!</div>
                <button class="revival-btn" onclick="reviveBulk()">REVIVE âœ¨</button>
            </div>
            <div id="minigame-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; text-align: center;">
                    <span id="game-title">QUICK CLICK!</span>
                </div>
                <div style="font-size: clamp(0.5rem, 2vw, 0.7rem); color: #9b30ff; text-align: center;">Score: <span id="game-score">0</span></div>
                <div style="font-size: clamp(0.5rem, 2vw, 0.7rem); color: #ff00ff; text-align: center;">
                    <span id="game-timer-label">Time: </span><span id="game-time">10</span>s
                </div>
                <div id="game-area" style="width: 100%; height: 300px; position: relative;"></div>
                <button class="close-modal-btn" onclick="closeMiniGame()">CLOSE</button>
            </div>
            <div id="achievements-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 20px;">ðŸ† ACHIEVEMENTS ðŸ†</div>
                <div id="achievements-list"></div>
                <button class="close-modal-btn" onclick="closeAchievements()">CLOSE</button>
            </div>
            <div id="settings-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 20px;">âš™ï¸ SETTINGS âš™ï¸</div>
                <div class="setting-row">
                    <span>SOUND EFFECTS</span>
                    <div class="toggle-btn active" id="sound-toggle" onclick="toggleSound()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="setting-row">
                    <span>WEATHER EFFECTS</span>
                    <div class="toggle-btn active" id="weather-toggle" onclick="toggleWeather()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="setting-row">
                    <span>PARTICLES</span>
                    <div class="toggle-btn active" id="particles-toggle" onclick="toggleParticles()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div style="color: #9b30ff; font-size: clamp(0.5rem, 2vw, 0.6rem); margin-top: 15px;">BACKGROUND THEME</div>
                <div id="theme-selector">
                    <div class="theme-btn selected" style="background: #1a1a1a;" onclick="setTheme('default')" title="Default"></div>
                    <div class="theme-btn" style="background: linear-gradient(135deg, #ff7e5f, #feb47b);" onclick="setTheme('sunset')" title="Sunset"></div>
                    <div class="theme-btn" style="background: linear-gradient(135deg, #2193b0, #6dd5ed);" onclick="setTheme('ocean')" title="Ocean"></div>
                    <div class="theme-btn locked" style="background: linear-gradient(135deg, #134e5e, #71b280);" onclick="setTheme('forest')" title="Forest (Lv 5)"></div>
                    <div class="theme-btn locked" style="background: linear-gradient(135deg, #0f0c29, #302b63);" onclick="setTheme('space')" title="Space (Lv 10)"></div>
                    <div class="theme-btn locked" style="background: linear-gradient(135deg, #ff9a9e, #fecfef);" onclick="setTheme('candy')" title="Candy (Lv 15)"></div>
                </div>
                <button class="close-modal-btn" onclick="closeSettings()">CLOSE</button>
            </div>
            <div id="shop-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 10px;">ðŸ›’ BULK SHOP ðŸ›’</div>
                <div style="font-size: clamp(0.5rem, 2vw, 0.6rem); color: #ff69b4; margin-bottom: 20px;">Your coins: <span id="shop-coins">0</span> ðŸª™</div>
                <div id="shop-items"></div>
                <button class="close-modal-btn" onclick="closeShop()">CLOSE</button>
            </div>
            <div id="toys-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 10px;">ðŸ§¸ TOY BOX ðŸ§¸</div>
                <div style="font-size: clamp(0.5rem, 2vw, 0.6rem); color: #ff69b4; margin-bottom: 20px;">Your coins: <span id="toys-coins">0</span> ðŸª™</div>
                <div id="toys-items"></div>
                <button class="close-modal-btn" onclick="closeToys()">CLOSE</button>
            </div>
            <div id="tricks-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 10px;">ðŸŽª TRICKS ðŸŽª</div>
                <div style="font-size: clamp(0.5rem, 2vw, 0.6rem); color: #dda0dd; margin-bottom: 20px;">Teach Bulk cool tricks!</div>
                <div id="tricks-items"></div>
                <button class="close-modal-btn" onclick="closeTricks()">CLOSE</button>
            </div>
            <div id="fortune-modal">
                <div style="font-size: 2rem; margin-bottom: 10px;">ðŸ¥ </div>
                <div style="font-size: clamp(0.6rem, 2.5vw, 0.8rem); color: #8b4513;">TODAY'S FORTUNE</div>
                <div class="fortune-text" id="fortune-text"></div>
                <div class="fortune-lucky" id="fortune-lucky"></div>
                <button class="close-modal-btn" onclick="closeFortune()" style="margin-top: 15px;">OK!</button>
            </div>
            <div id="stats-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 15px;">ðŸ“Š BULK'S LIFE ðŸ“Š</div>
                <div id="stats-content"></div>
                <button class="close-modal-btn" onclick="closeStats()">CLOSE</button>
            </div>
            <div id="quests-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 15px;">ðŸ“œ DAILY QUESTS ðŸ“œ</div>
                <div id="quests-content"></div>
                <button class="close-modal-btn" onclick="closeQuests()">CLOSE</button>
            </div>
            <div id="color-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 15px;">ðŸŽ¨ BULK COLORS ðŸŽ¨</div>
                <div style="font-size: clamp(0.5rem, 2vw, 0.6rem); color: #ff69b4; margin-bottom: 15px;">Choose Bulk's color!</div>
                <div class="color-grid" id="color-grid"></div>
                <button class="close-modal-btn" onclick="closeColorPicker()">CLOSE</button>
            </div>
            <div id="memory-game-modal">
                <div style="font-size: clamp(1rem, 4vw, 1.5rem); color: #ffd700; margin-bottom: 10px;">ðŸ§  MEMORY MATCH ðŸ§ </div>
                <div style="font-size: clamp(0.5rem, 2vw, 0.6rem); color: #ff69b4; margin-bottom: 10px;">Moves: <span id="memory-moves">0</span> | Pairs: <span id="memory-pairs">0</span>/6</div>
                <div id="memory-grid"></div>
                <button class="close-modal-btn" onclick="closeMemoryGame()">CLOSE</button>
            </div>
            <div id="mood-indicator"></div>
            <div id="event-notification"></div>
            <div id="message"></div>
        </div>

        <div id="stats">
            <div class="stat-row">
                <div class="stat-label">HUNGER</div>
                <div class="stat-bar-container">
                    <div class="stat-bar hunger" id="hunger-bar" style="width: 100%"></div>
                </div>
            </div>
            <div class="stat-row">
                <div class="stat-label">HAPPY</div>
                <div class="stat-bar-container">
                    <div class="stat-bar happiness" id="happiness-bar" style="width: 100%"></div>
                </div>
            </div>
            <div class="stat-row">
                <div class="stat-label">CLEAN</div>
                <div class="stat-bar-container">
                    <div class="stat-bar cleanliness" id="cleanliness-bar" style="width: 100%"></div>
                </div>
            </div>
        </div>

        <div id="actions">
            <button class="action-btn" onclick="toggleFoodMenu()" style="position: relative;">
                <div id="food-menu">
                    <div class="food-item" onclick="event.stopPropagation(); feedBulk('schmeg')">
                        <span class="food-emoji">ðŸ¥¤</span>
                        <span>SCHMEG +30</span>
                    </div>
                    <div class="food-item" onclick="event.stopPropagation(); feedBulk('protein')">
                        <span class="food-emoji">ðŸ¥©</span>
                        <span>PROTEIN +40</span>
                    </div>
                    <div class="food-item" onclick="event.stopPropagation(); feedBulk('snack')">
                        <span class="food-emoji">ðŸª</span>
                        <span>SNACK +20</span>
                    </div>
                    <div class="food-item" onclick="event.stopPropagation(); feedBulk('feast')">
                        <span class="food-emoji">ðŸ•</span>
                        <span>FEAST +50</span>
                    </div>
                </div>
                <span class="emoji">ðŸ´</span>
                <span>FEED</span>
            </button>
            <button class="action-btn" onclick="playWithBulk()">
                <span class="emoji">ðŸŽ®</span>
                <span>PLAY</span>
            </button>
            <button class="action-btn" onclick="cleanBulk()">
                <span class="emoji">ðŸ§¼</span>
                <span>CLEAN</span>
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script>
        // Check if Three.js loaded
        if (typeof THREE === 'undefined') {
            console.error('THREE.js failed to load!');
            alert('Failed to load 3D library. Please check your internet connection.');
        } else {
            console.log('THREE.js loaded successfully, version:', THREE.REVISION);
        }

        // Game State
        let scene, camera, renderer, bulk, bulkModel;
        let hunger = 100;
        let happiness = 100;
        let cleanliness = 100;
        let lastUpdateTime = Date.now();
        let birthTime = Date.now();
        let comboCount = 0;
        let lastActionTime = 0;
        let isSleeping = false;
        let isDead = false;
        let totalCareActions = 0;
        let achievements = {};
        let miniGameScore = 0;
        let miniGameActive = false;
        let soundEnabled = true;
        let weatherEnabled = true;
        let particlesEnabled = true;
        let currentWeather = 'clear';
        let lastEventTime = Date.now();
        let currentGameMode = 'click'; // 'click' or 'memory'
        let level = 1;
        let xp = 0;
        let careStreak = 0;
        let lastCareDate = null;
        let dreamBonus = 0;
        let currentTheme = 'default';
        let lastThoughtTime = 0;
        let coins = 0;
        let ownedAccessories = [];
        let equippedAccessory = null;
        let poopCount = 0;
        let lastPoopTime = Date.now();
        let isDancing = false;
        let poopUrgency = 0;
        let totalPoopsCleaned = 0;
        let goldenPoopsCleaned = 0;
        let lastFeedTime = 0;
        let isSick = false;
        let sickTime = 0;
        let ownedToys = [];
        let activeToy = null;
        let learnedTricks = [];
        let lastFortuneDate = null;
        let lastVisitorTime = 0;
        let currentVisitor = null;

        // Audio Context for sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Load saved state
        function loadState() {
            const saved = localStorage.getItem('bulkagachi');
            if (saved) {
                const state = JSON.parse(saved);
                hunger = state.hunger || 100;
                happiness = state.happiness || 100;
                cleanliness = state.cleanliness || 100;
                lastUpdateTime = state.lastUpdateTime || Date.now();
                birthTime = state.birthTime || Date.now();
                totalCareActions = state.totalCareActions || 0;
                isDead = state.isDead || false;

                // Calculate decay since last visit
                const timePassed = (Date.now() - lastUpdateTime) / 1000; // seconds
                const minutesPassed = timePassed / 60;

                if (!isDead) {
                    hunger = Math.max(0, hunger - minutesPassed * 2);
                    happiness = Math.max(0, happiness - minutesPassed * 1.5);
                    cleanliness = Math.max(0, cleanliness - minutesPassed * 1);
                }

                // Check if all stats are 0
                if (hunger === 0 && happiness === 0 && cleanliness === 0 && !isDead) {
                    isDead = true;
                    showRevivalScreen();
                }

                // Show welcome back message
                if (minutesPassed > 1 && !isDead) {
                    setTimeout(() => {
                        if (minutesPassed < 60) {
                            showMessage(`WELCOME BACK! YOU WERE GONE FOR ${Math.round(minutesPassed)} MIN! ðŸ‘‹`);
                        } else if (minutesPassed < 1440) {
                            showMessage(`WELCOME BACK! YOU WERE GONE FOR ${Math.round(minutesPassed / 60)} HOURS! ðŸ‘‹`);
                        } else {
                            showMessage(`WELCOME BACK! YOU WERE GONE FOR ${Math.round(minutesPassed / 1440)} DAYS! ðŸ‘‹`);
                        }
                    }, 1000);
                }
            } else {
                // First time playing
                birthTime = Date.now();
                setTimeout(() => {
                    showMessage("HELLO! I'M BULK! TAKE CARE OF ME! ðŸ’œ");
                }, 1000);
            }
        }

        function saveState() {
            const state = {
                hunger,
                happiness,
                cleanliness,
                lastUpdateTime: Date.now(),
                birthTime,
                totalCareActions,
                isDead
            };
            localStorage.setItem('bulkagachi', JSON.stringify(state));
        }

        // Initialize Three.js
        function init() {
            const container = document.getElementById('scene-container');
            console.log('Container dimensions:', container.clientWidth, container.clientHeight);

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a);

            camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 1.5, 3);
            camera.lookAt(0, 1, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            console.log('Canvas created with size:', renderer.domElement.width, renderer.domElement.height);
            container.appendChild(renderer.domElement);
            console.log('Canvas appended to container');

            // Lighting
            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);

            const light1 = new THREE.DirectionalLight(0x9b30ff, 0.8);
            light1.position.set(5, 5, 5);
            scene.add(light1);

            const light2 = new THREE.DirectionalLight(0xff00ff, 0.5);
            light2.position.set(-5, 3, -5);
            scene.add(light2);

            // Ground
            const groundGeo = new THREE.CircleGeometry(3, 32);
            const groundMat = new THREE.MeshStandardMaterial({
                color: 0x2d1b4e,
                roughness: 0.8
            });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // Shadow under Bulk
            const shadowGeo = new THREE.CircleGeometry(0.6, 32);
            const shadowMat = new THREE.MeshBasicMaterial({
                color: 0x000000,
                transparent: true,
                opacity: 0.3
            });
            const shadow = new THREE.Mesh(shadowGeo, shadowMat);
            shadow.rotation.x = -Math.PI / 2;
            shadow.position.y = 0.01;
            scene.add(shadow);

            // Load Bulk model
            bulk = new THREE.Group();
            bulk.position.set(0, 0.4, 0);
            scene.add(bulk);

            const loader = new THREE.GLTFLoader();
            console.log('Loading bulk.glb model...');
            loader.load('bulk.glb',
                (gltf) => {
                    console.log('Model loaded successfully!');
                    bulkModel = gltf.scene;

                    // Scale model
                    const box = new THREE.Box3().setFromObject(bulkModel);
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = 2 / maxDim;
                    bulkModel.scale.set(scale, scale, scale);

                    bulk.add(bulkModel);
                    console.log('Model added to scene');
                },
                (progress) => {
                    console.log('Loading progress:', (progress.loaded / progress.total * 100).toFixed(2) + '%');
                },
                (error) => {
                    console.error('Error loading model:', error);
                    createFallbackBulk();
                }
            );

            // Handle resize
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });

            loadState();
            updateUI();
            updateAge();
            updateGrowthStage();
            checkSleepTime();
            updateBackground();
            animate();

            // Add click interaction with Bulk
            renderer.domElement.addEventListener('click', (e) => {
                if (isDead || isSleeping) return;

                const rect = renderer.domElement.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // Simple check if clicked near center (where Bulk is)
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));

                if (distance < 150) {
                    petBulk(x, y);
                }
            });
        }

        function createFallbackBulk() {
            console.log('Creating fallback Bulk model (purple box)');
            const geo = new THREE.BoxGeometry(1, 1.5, 0.8);
            const mat = new THREE.MeshStandardMaterial({ color: 0x9b30ff });
            bulkModel = new THREE.Mesh(geo, mat);
            bulk.add(bulkModel);
            console.log('Fallback model added to scene');
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            // Idle animation - gentle bobbing with mood variation
            if (bulk && !isDead) {
                const avgStats = (hunger + happiness + cleanliness) / 3;
                const baseHeight = 0.4; // Base floating height

                // Different animation when sleeping
                if (isSleeping) {
                    bulk.position.y = baseHeight + Math.sin(Date.now() * 0.0003) * 0.03; // Very slow, small movement
                    bulk.rotation.y = 0; // No rotation when sleeping
                } else {
                    const bobbingSpeed = avgStats > 50 ? 0.001 : 0.0005; // Slower when sad
                    const bobbingAmount = avgStats > 50 ? 0.1 : 0.05; // Less movement when sad

                    // Extra bounce when perfect care
                    const perfectBonus = (hunger === 100 && happiness === 100 && cleanliness === 100) ? 0.05 : 0;

                    bulk.position.y = baseHeight + Math.sin(Date.now() * bobbingSpeed) * (bobbingAmount + perfectBonus);
                    bulk.rotation.y = Math.sin(Date.now() * 0.0005) * 0.2;

                    // Slight scale pulse when very happy
                    if (avgStats > 80) {
                        const scale = 1 + Math.sin(Date.now() * 0.001) * 0.02;
                        bulk.scale.set(scale, scale, scale);
                    } else {
                        bulk.scale.set(1, 1, 1);
                    }
                }
            }

            // Change Bulk's color based on mood
            if (bulkModel && bulkModel.traverse) {
                bulkModel.traverse((child) => {
                    if (child.isMesh && child.material) {
                        const material = child.material;

                        if (isSleeping) {
                            material.emissive = new THREE.Color(0x1a0a2e); // Dark when sleeping
                            material.emissiveIntensity = 0.05;
                        } else if (isDead) {
                            material.emissive = new THREE.Color(0x000000); // Black when dead
                            material.emissiveIntensity = 0;
                        } else {
                            const avgStats = (hunger + happiness + cleanliness) / 3;

                            // Perfect care - rainbow glow effect!
                            if (hunger === 100 && happiness === 100 && cleanliness === 100) {
                                const time = Date.now() * 0.001;
                                const r = Math.sin(time * 2) * 0.5 + 0.5;
                                const g = Math.sin(time * 2 + 2) * 0.5 + 0.5;
                                const b = Math.sin(time * 2 + 4) * 0.5 + 0.5;
                                material.emissive = new THREE.Color(r, g, b);
                                material.emissiveIntensity = 0.5;
                            } else if (avgStats > 80) {
                                material.emissive = new THREE.Color(0xff00ff); // Bright magenta when very happy
                                material.emissiveIntensity = 0.4;
                            } else if (avgStats > 70) {
                                material.emissive = new THREE.Color(0x9b30ff); // Happy purple glow
                                material.emissiveIntensity = 0.3;
                            } else if (avgStats > 40) {
                                material.emissive = new THREE.Color(0x6a0dad); // Neutral purple
                                material.emissiveIntensity = 0.1;
                            } else if (avgStats > 20) {
                                material.emissive = new THREE.Color(0x4a0080); // Sad dark purple
                                material.emissiveIntensity = 0.05;
                            } else {
                                material.emissive = new THREE.Color(0x2d004d); // Miserable very dark
                                material.emissiveIntensity = 0.02;
                            }
                        }
                    }
                });
            }

            renderer.render(scene, camera);
        }

        // Floating emoji effect
        function createFloatingEmoji(emoji, x, y) {
            const floater = document.createElement('div');
            floater.className = 'floating-emoji';
            floater.textContent = emoji;
            floater.style.left = x + 'px';
            floater.style.top = y + 'px';
            document.getElementById('scene-container').appendChild(floater);

            setTimeout(() => floater.remove(), 2000);
        }

        // Combo system
        function updateCombo() {
            const now = Date.now();
            const timeSinceLastAction = now - lastActionTime;

            if (timeSinceLastAction < 5000) { // 5 seconds window
                comboCount++;
            } else {
                comboCount = 1;
            }

            lastActionTime = now;
            totalCareActions++;

            // Track longest combo and quest progress
            if (comboCount > lifeStats.longestCombo) {
                lifeStats.longestCombo = comboCount;
            }
            updateQuestProgress('combo', comboCount);

            const comboIndicator = document.getElementById('combo-indicator');
            const comboCountDisplay = document.getElementById('combo-count');

            if (comboCount > 3) {
                comboCountDisplay.textContent = comboCount;
                comboIndicator.style.display = 'block';

                // Bonus rewards for combos
                if (comboCount === 5) {
                    showMessage("ðŸ”¥ COMBO x5! BONUS HAPPINESS! ðŸ”¥");
                    happiness = Math.min(100, happiness + 10);
                } else if (comboCount === 10) {
                    showMessage("â­ COMBO x10! MEGA BONUS! â­");
                    happiness = Math.min(100, happiness + 20);
                    hunger = Math.min(100, hunger + 10);
                    cleanliness = Math.min(100, cleanliness + 10);
                } else if (comboCount > 10 && comboCount % 5 === 0) {
                    showMessage(`ðŸŒŸ AMAZING! x${comboCount} COMBO! ðŸŒŸ`);
                }
            } else {
                comboIndicator.style.display = 'none';
            }

            // Reset combo after 5 seconds of inactivity
            setTimeout(() => {
                if (Date.now() - lastActionTime >= 5000) {
                    comboCount = 0;
                    comboIndicator.style.display = 'none';
                }
            }, 5000);
        }

        // Age tracking
        function updateAge() {
            const ageInMs = Date.now() - birthTime;
            const days = Math.floor(ageInMs / (1000 * 60 * 60 * 24));
            const hours = Math.floor((ageInMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((ageInMs % (1000 * 60 * 60)) / (1000 * 60));

            const ageDisplay = document.getElementById('age-display');
            if (days > 0) {
                ageDisplay.textContent = `${days}d ${hours}h`;
            } else if (hours > 0) {
                ageDisplay.textContent = `${hours}h ${minutes}m`;
            } else {
                ageDisplay.textContent = `${minutes}m`;
            }
        }

        // Growth stages
        function updateGrowthStage() {
            const ageInHours = (Date.now() - birthTime) / (1000 * 60 * 60);
            const stageDisplay = document.getElementById('growth-stage');

            if (ageInHours < 1) {
                stageDisplay.textContent = 'BABY ðŸ¼';
            } else if (ageInHours < 24) {
                stageDisplay.textContent = 'CHILD ðŸ‘¶';
            } else if (ageInHours < 72) {
                stageDisplay.textContent = 'TEEN ðŸ§’';
            } else {
                stageDisplay.textContent = 'ADULT ðŸ’ª';
            }
        }

        // Sleep mode (night time)
        function checkSleepTime() {
            const hour = new Date().getHours();
            const sleepOverlay = document.getElementById('sleep-overlay');
            const dreamBtn = document.getElementById('dream-btn');

            // Sleep between 10 PM and 6 AM
            if (hour >= 22 || hour < 6) {
                isSleeping = true;
                sleepOverlay.classList.add('active');
                dreamBtn.classList.add('visible');
            } else {
                isSleeping = false;
                sleepOverlay.classList.remove('active');
                dreamBtn.classList.remove('visible');
            }
        }

        // Day/night background
        function updateBackground() {
            const hour = new Date().getHours();
            const sceneContainer = document.getElementById('scene-container');

            if (hour >= 6 && hour < 12) {
                // Morning
                scene.background = new THREE.Color(0x2a2a3a);
            } else if (hour >= 12 && hour < 18) {
                // Afternoon
                scene.background = new THREE.Color(0x1a1a2a);
            } else if (hour >= 18 && hour < 22) {
                // Evening
                scene.background = new THREE.Color(0x15152a);
            } else {
                // Night
                scene.background = new THREE.Color(0x0a0a1a);
            }
        }

        // Revival system
        function showRevivalScreen() {
            document.getElementById('revival-screen').classList.add('active');
        }

        function reviveBulk() {
            isDead = false;
            hunger = 50;
            happiness = 50;
            cleanliness = 50;
            document.getElementById('revival-screen').classList.remove('active');
            showMessage("BULK IS BACK! TAKE BETTER CARE! ðŸ’š");
            playSound('play');
            createParticles('#00ff00', 40);
            if (!achievements.revival) unlockAchievement('revival');
            updateUI();
            saveState();
        }

        // Update stats over time
        setInterval(() => {
            if (isDead) return;

            // Much slower decay while sleeping (Bulk is resting!)
            if (isSleeping) {
                hunger = Math.max(0, hunger - 0.1); // 5x slower decay
                happiness = Math.max(0, happiness - 0.05);
                cleanliness = Math.max(0, cleanliness - 0.02);
            } else {
                hunger = Math.max(0, hunger - 0.5);
                happiness = Math.max(0, happiness - 0.3);
                cleanliness = Math.max(0, cleanliness - 0.2);
            }

            // Check for death - but not during sleep!
            if (!isSleeping && hunger === 0 && happiness === 0 && cleanliness === 0) {
                isDead = true;
                showRevivalScreen();
            }

            updateUI();
            updateNeedsIndicators();
            saveState();
        }, 10000); // Every 10 seconds

        // Update age every minute
        setInterval(() => {
            updateAge();
            updateGrowthStage();
            checkSleepTime();
            updateBackground();
        }, 60000); // Every minute

        // Sound Effects
        function playSound(type) {
            if (!soundEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);

            if (type === 'feed') {
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.1);
            } else if (type === 'play') {
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.15);
            } else if (type === 'clean') {
                oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(700, audioContext.currentTime + 0.12);
            }

            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // Particle Effects
        function createParticles(color, count = 20) {
            if (!particlesEnabled) return;

            const container = document.getElementById('scene-container');
            const rect = container.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.backgroundColor = color;
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';

                const angle = (Math.PI * 2 * i) / count;
                const distance = 50 + Math.random() * 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;

                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');

                container.appendChild(particle);

                setTimeout(() => particle.remove(), 1000);
            }
        }

        // Food Menu
        function toggleFoodMenu() {
            const menu = document.getElementById('food-menu');
            menu.classList.toggle('active');
        }

        // Actions
        function feedBulk(foodType = 'schmeg') {
            if (isDead || isSleeping) {
                if (isSleeping) showMessage("SHHH! BULK IS SLEEPING! ðŸ’¤");
                return;
            }

            // Close food menu
            document.getElementById('food-menu').classList.remove('active');

            const foods = {
                schmeg: {
                    hunger: 30,
                    happiness: 10,
                    messages: ["YUM! PURPLE SCHMEG! ðŸ¥¤", "DELICIOUS! *SLURP* ðŸ¥¤", "MORE SCHMEG PLZ! ðŸ¥¤", "SO TASTY! ðŸ¥¤", "BULK LOVES SCHMEG! ðŸ¥¤"],
                    color: '#ff00ff'
                },
                protein: {
                    hunger: 40,
                    happiness: 15,
                    messages: ["PROTEIN POWER! ðŸ¥©", "GAINS! BULK GETTING SWOLE! ðŸ¥©", "MEATY GOODNESS! ðŸ¥©", "SO FILLING! ðŸ¥©"],
                    color: '#ff0000'
                },
                snack: {
                    hunger: 20,
                    happiness: 20,
                    messages: ["SWEET TREAT! ðŸª", "YUMMY SNACK! ðŸª", "MORE COOKIES! ðŸª", "DELICIOUS! ðŸª"],
                    color: '#ffa500'
                },
                feast: {
                    hunger: 50,
                    happiness: 25,
                    messages: ["FEAST TIME! ðŸ•", "HUGE MEAL! SO GOOD! ðŸ•", "BEST MEAL EVER! ðŸ•", "BULK IS STUFFED! ðŸ•"],
                    color: '#ffff00'
                }
            };

            const food = foods[foodType] || foods.schmeg;
            hunger = Math.min(100, hunger + food.hunger);
            happiness = Math.min(100, happiness + food.happiness);
            showMessage(food.messages[Math.floor(Math.random() * food.messages.length)]);
            playSound('feed');
            createParticles(food.color, 25);
            playJumpAnimation();
            updateCombo();
            addXP(10);
            addCoins(3);
            updateStreak();

            // Eating increases poop urgency!
            lastFeedTime = Date.now();
            poopUrgency = Math.min(100, poopUrgency + 20 + food.hunger / 2);
            updatePoopMeter();

            // Track stats and quests
            lifeStats.totalFeedings++;
            updateQuestProgress('feed');

            updateUI();
            saveState();
        }

        function playWithBulk() {
            if (isDead || isSleeping) {
                if (isSleeping) showMessage("SHHH! BULK IS SLEEPING! ðŸ’¤");
                return;
            }

            const messages = [
                "WHEEE! FUN TIME! ðŸŽ®",
                "BEST GAME EVER! ðŸŽ®",
                "PLAY MORE! PLAY MORE! ðŸŽ®",
                "THIS IS AWESOME! ðŸŽ®",
                "BULK IS HAVING FUN! ðŸŽ®"
            ];

            happiness = Math.min(100, happiness + 40);
            hunger = Math.max(0, hunger - 5);
            showMessage(messages[Math.floor(Math.random() * messages.length)]);
            playSound('play');
            createParticles('#ffd700', 30);
            playSpinAnimation();
            updateCombo();
            addXP(12);
            addCoins(5);
            updateStreak();

            // Track stats and quests
            lifeStats.totalPlays++;
            updateQuestProgress('play');

            updateUI();
            saveState();
        }

        function cleanBulk() {
            if (isDead || isSleeping) {
                if (isSleeping) showMessage("SHHH! BULK IS SLEEPING! ðŸ’¤");
                return;
            }

            const messages = [
                "SO FRESH! SO CLEAN! ðŸ§¼",
                "SPARKLE SPARKLE! âœ¨ðŸ§¼",
                "SQUEAKY CLEAN! ðŸ§¼",
                "FRESH AS A DAISY! ðŸ§¼",
                "BULK IS SHINY! âœ¨ðŸ§¼"
            ];

            cleanliness = Math.min(100, cleanliness + 50);
            happiness = Math.min(100, happiness + 5);
            showMessage(messages[Math.floor(Math.random() * messages.length)]);
            playSound('clean');
            createParticles('#00ffff', 25);
            playHappyAnimation();
            updateCombo();
            addXP(8);
            addCoins(4);
            updateStreak();

            // Track stats and quests
            lifeStats.totalCleans++;
            updateQuestProgress('clean');

            updateUI();
            saveState();
        }

        // Animations
        function playHappyAnimation() {
            if (bulkModel) {
                const startY = bulk.position.y;
                let time = 0;
                const duration = 500;

                function bounce() {
                    time += 16;
                    const progress = time / duration;
                    const bounceHeight = Math.sin(progress * Math.PI) * 0.3;
                    bulk.position.y = startY + bounceHeight;

                    if (time < duration) {
                        requestAnimationFrame(bounce);
                    } else {
                        bulk.position.y = startY;
                    }
                }
                bounce();
            }
        }

        function playJumpAnimation() {
            if (bulkModel) {
                const startY = bulk.position.y;
                let time = 0;
                const duration = 600;

                function jump() {
                    time += 16;
                    const progress = time / duration;
                    const jumpHeight = Math.sin(progress * Math.PI) * 0.5;
                    const scale = 1 + Math.sin(progress * Math.PI) * 0.1;

                    bulk.position.y = startY + jumpHeight;
                    bulk.scale.set(scale, scale, scale);

                    if (time < duration) {
                        requestAnimationFrame(jump);
                    } else {
                        bulk.position.y = startY;
                        bulk.scale.set(1, 1, 1);
                    }
                }
                jump();
            }
        }

        function playSpinAnimation() {
            if (bulkModel) {
                let time = 0;
                const duration = 800;
                const startRotation = bulk.rotation.y;

                function spin() {
                    time += 16;
                    const progress = time / duration;
                    bulk.rotation.y = startRotation + (progress * Math.PI * 2);

                    if (time < duration) {
                        requestAnimationFrame(spin);
                    } else {
                        bulk.rotation.y = startRotation;
                    }
                }
                spin();
            }
        }

        function playSadAnimation() {
            if (bulkModel) {
                let time = 0;
                const duration = 500;

                function shake() {
                    time += 16;
                    const progress = time / duration;
                    const shakeAmount = Math.sin(progress * Math.PI * 8) * 0.1;
                    bulk.position.x = shakeAmount;

                    if (time < duration) {
                        requestAnimationFrame(shake);
                    } else {
                        bulk.position.x = 0;
                    }
                }
                shake();
            }
        }

        // UI Updates
        function updateUI() {
            const hungerBar = document.getElementById('hunger-bar');
            const happinessBar = document.getElementById('happiness-bar');
            const cleanlinessBar = document.getElementById('cleanliness-bar');

            hungerBar.style.width = hunger + '%';
            happinessBar.style.width = happiness + '%';
            cleanlinessBar.style.width = cleanliness + '%';

            // Show percentages
            hungerBar.textContent = Math.round(hunger) + '%';
            happinessBar.textContent = Math.round(happiness) + '%';
            cleanlinessBar.textContent = Math.round(cleanliness) + '%';

            // Add pulsing effect to low stats
            hungerBar.classList.toggle('low', hunger < 30);
            happinessBar.classList.toggle('low', happiness < 30);
            cleanlinessBar.classList.toggle('low', cleanliness < 30);

            // Warnings for critical stats
            if (hunger < 20 || happiness < 20 || cleanliness < 20) {
                if (hunger < 20 && Math.random() < 0.1) {
                    showMessage("BULK IS STARVING! ðŸ˜¢");
                    playSadAnimation();
                } else if (happiness < 20 && Math.random() < 0.1) {
                    showMessage("BULK IS SAD! ðŸ˜­");
                    playSadAnimation();
                } else if (cleanliness < 20 && Math.random() < 0.1) {
                    showMessage("BULK IS DIRTY! ðŸ¤¢");
                    playSadAnimation();
                }
            }

            updateMood();
            updateMoodIndicator();
        }

        function updateMood() {
            const avgStats = (hunger + happiness + cleanliness) / 3;
            const moodEmoji = document.getElementById('mood-emoji');
            const moodText = document.getElementById('mood-text');

            if (avgStats > 70) {
                moodEmoji.textContent = 'ðŸ˜Š';
                moodText.textContent = 'HAPPY';
            } else if (avgStats > 40) {
                moodEmoji.textContent = 'ðŸ˜';
                moodText.textContent = 'OKAY';
            } else if (avgStats > 20) {
                moodEmoji.textContent = 'ðŸ˜¢';
                moodText.textContent = 'SAD';
            } else {
                moodEmoji.textContent = 'ðŸ˜­';
                moodText.textContent = 'MISERABLE';
            }
        }

        function showMessage(text) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.classList.add('show');
            setTimeout(() => msg.classList.remove('show'), 2000);
        }

        // Achievements System
        const achievementsList = [
            { id: 'firstFeed', icon: 'ðŸ¥¤', title: 'First Meal', desc: 'Feed Bulk for the first time' },
            { id: 'combo10', icon: 'ðŸ”¥', title: 'Combo Master', desc: 'Reach a 10x combo' },
            { id: 'perfectCare', icon: 'ðŸ’¯', title: 'Perfect Care', desc: 'Get all stats to 100%' },
            { id: 'oneDay', icon: 'ðŸŽ‚', title: 'First Birthday', desc: 'Keep Bulk alive for 1 day' },
            { id: 'care100', icon: 'â¤ï¸', title: 'Dedicated Carer', desc: 'Perform 100 care actions' },
            { id: 'care500', icon: 'ðŸ’ª', title: 'Super Parent', desc: 'Perform 500 care actions' },
            { id: 'gameWin', icon: 'ðŸŽ¯', title: 'Quick Hands', desc: 'Score 20+ in mini-game' },
            { id: 'revival', icon: 'âœ¨', title: 'Second Chance', desc: 'Revive Bulk' },
            { id: 'threeDays', icon: 'ðŸŒŸ', title: 'Week Warrior', desc: 'Keep Bulk alive for 3 days' },
            { id: 'allMax', icon: 'ðŸ‘‘', title: 'Perfection', desc: 'Keep all stats at 100% for 1 hour' },
            { id: 'dreamGiver', icon: 'ðŸŒ™', title: 'Dream Giver', desc: 'Give Bulk sweet dreams' },
            { id: 'streak3', icon: 'ðŸ”¥', title: 'On Fire', desc: 'Maintain a 3-day care streak' },
            { id: 'streak7', icon: 'âš¡', title: 'Unstoppable', desc: 'Maintain a 7-day care streak' },
            { id: 'level5', icon: 'â­', title: 'Rising Star', desc: 'Reach Level 5' },
            { id: 'level10', icon: 'ðŸŒŸ', title: 'Superstar', desc: 'Reach Level 10' },
            { id: 'memoryMaster', icon: 'ðŸ§ ', title: 'Memory Master', desc: 'Win memory game perfectly' },
            { id: 'allFoods', icon: 'ðŸ½ï¸', title: 'Foodie', desc: 'Try all food types' },
            { id: 'eventLucky', icon: 'ðŸ€', title: 'Lucky Star', desc: 'Experience 5 special events' },
            { id: 'goldenPoop', icon: 'âœ¨', title: 'Golden Discovery', desc: 'Find and clean a golden poop' },
            { id: 'poopMaster', icon: 'ðŸ’©', title: 'Poop Master', desc: 'Clean 50 poops total' },
            { id: 'doctor', icon: 'ðŸ’Š', title: 'Doctor Bulk', desc: 'Cure Bulk when sick' },
            { id: 'trickster', icon: 'ðŸŽª', title: 'Trickster', desc: 'Learn 3 tricks' },
            { id: 'fortunate', icon: 'ðŸ¥ ', title: 'Fortune Seeker', desc: 'Open a fortune cookie' },
            { id: 'socialButterfly', icon: 'ðŸ¦‹', title: 'Social Butterfly', desc: 'Receive a visitor' },
            { id: 'bathLover', icon: 'ðŸ›', title: 'Bath Lover', desc: 'Give Bulk 10 baths' },
            { id: 'colorful', icon: 'ðŸŒˆ', title: 'Colorful', desc: 'Own 5 different colors' },
            { id: 'questHero', icon: 'ðŸ“œ', title: 'Quest Hero', desc: 'Complete 10 daily quests' }
        ];

        function checkAchievements() {
            const ageInDays = (Date.now() - birthTime) / (1000 * 60 * 60 * 24);

            if (totalCareActions >= 1 && !achievements.firstFeed) unlockAchievement('firstFeed');
            if (comboCount >= 10 && !achievements.combo10) unlockAchievement('combo10');
            if (hunger === 100 && happiness === 100 && cleanliness === 100 && !achievements.perfectCare) unlockAchievement('perfectCare');
            if (ageInDays >= 1 && !achievements.oneDay) unlockAchievement('oneDay');
            if (totalCareActions >= 100 && !achievements.care100) unlockAchievement('care100');
            if (totalCareActions >= 500 && !achievements.care500) unlockAchievement('care500');
            if (ageInDays >= 3 && !achievements.threeDays) unlockAchievement('threeDays');
            if (careStreak >= 3 && !achievements.streak3) unlockAchievement('streak3');
            if (careStreak >= 7 && !achievements.streak7) unlockAchievement('streak7');
            if (level >= 5 && !achievements.level5) unlockAchievement('level5');
            if (level >= 10 && !achievements.level10) unlockAchievement('level10');
        }

        function unlockAchievement(id) {
            achievements[id] = true;
            const achievement = achievementsList.find(a => a.id === id);
            if (achievement) {
                showMessage(`ðŸ† ACHIEVEMENT: ${achievement.title}! ðŸ†`);
                playSound('play');
                createParticles('#ffd700', 50);
                // Flash gold border
                document.getElementById('game-container').style.borderColor = '#ffd700';
                setTimeout(() => {
                    document.getElementById('game-container').style.borderColor = '#9b30ff';
                }, 500);
            }
            saveState();
        }

        function showAchievements() {
            const modal = document.getElementById('achievements-modal');
            const list = document.getElementById('achievements-list');
            list.innerHTML = '';

            achievementsList.forEach(achievement => {
                const div = document.createElement('div');
                div.className = 'achievement' + (achievements[achievement.id] ? ' unlocked' : '');
                div.innerHTML = `
                    <div class="achievement-icon">${achievements[achievement.id] ? achievement.icon : 'ðŸ”’'}</div>
                    <div class="achievement-info">
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                    </div>
                `;
                list.appendChild(div);
            });

            modal.classList.add('active');
        }

        function closeAchievements() {
            document.getElementById('achievements-modal').classList.remove('active');
        }

        // Mini-Game
        let gameInterval, gameTimeout;

        function startMiniGame() {
            if (isSleeping || isDead) return;

            // Alternate between game modes
            currentGameMode = currentGameMode === 'click' ? 'memory' : 'click';

            miniGameActive = true;
            miniGameScore = 0;

            const modal = document.getElementById('minigame-modal');
            const gameArea = document.getElementById('game-area');
            const scoreDisplay = document.getElementById('game-score');
            const timeDisplay = document.getElementById('game-time');
            const titleDisplay = document.getElementById('game-title');
            const timerLabel = document.getElementById('game-timer-label');

            modal.classList.add('active');
            gameArea.innerHTML = '';
            scoreDisplay.textContent = '0';

            if (currentGameMode === 'click') {
                titleDisplay.textContent = 'QUICK CLICK!';
                timerLabel.textContent = 'Time: ';
                let timeLeft = 10;
                timeDisplay.textContent = '10';

                // Spawn targets
                gameInterval = setInterval(() => {
                    spawnTarget();
                }, 800);

                // Countdown timer
                gameTimeout = setInterval(() => {
                    timeLeft--;
                    timeDisplay.textContent = timeLeft;

                    if (timeLeft <= 0) {
                        endMiniGame();
                    }
                }, 1000);
            } else {
                titleDisplay.textContent = 'MEMORY MATCH!';
                timerLabel.textContent = 'Pairs: ';
                timeDisplay.textContent = '0/8';
                startMemoryGame();
            }
        }

        function spawnTarget() {
            const gameArea = document.getElementById('game-area');
            const target = document.createElement('div');
            target.className = 'game-target';

            const maxX = gameArea.clientWidth - 80;
            const maxY = gameArea.clientHeight - 80;
            target.style.left = Math.random() * maxX + 'px';
            target.style.top = Math.random() * maxY + 'px';

            target.onclick = () => {
                miniGameScore++;
                document.getElementById('game-score').textContent = miniGameScore;
                playSound('play');
                target.remove();
            };

            gameArea.appendChild(target);

            // Remove after 1.5 seconds if not clicked
            setTimeout(() => {
                if (target.parentNode) target.remove();
            }, 1500);
        }

        function endMiniGame() {
            clearInterval(gameInterval);
            clearInterval(gameTimeout);

            const gameArea = document.getElementById('game-area');
            gameArea.innerHTML = `
                <div style="text-align: center; color: #ffd700; font-size: clamp(1rem, 4vw, 1.5rem);">
                    GAME OVER!<br>
                    Score: ${miniGameScore}
                </div>
            `;

            // Reward based on score
            if (miniGameScore >= 20) {
                happiness = Math.min(100, happiness + 30);
                showMessage("AMAZING! +30 HAPPINESS! ðŸŽ¯");
                if (!achievements.gameWin) unlockAchievement('gameWin');
            } else if (miniGameScore >= 10) {
                happiness = Math.min(100, happiness + 20);
                showMessage("GREAT JOB! +20 HAPPINESS! ðŸŽ¯");
            } else if (miniGameScore >= 5) {
                happiness = Math.min(100, happiness + 10);
                showMessage("NICE TRY! +10 HAPPINESS! ðŸŽ¯");
            }

            updateUI();
            saveState();
            miniGameActive = false;

            setTimeout(() => {
                document.getElementById('minigame-modal').classList.remove('active');
            }, 2000);
        }

        function closeMiniGame() {
            if (gameInterval) clearInterval(gameInterval);
            if (gameTimeout) clearInterval(gameTimeout);
            miniGameActive = false;
            document.getElementById('minigame-modal').classList.remove('active');
        }

        // Memory Game
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;

        function startMemoryGame() {
            const emojis = ['ðŸ’œ', 'ðŸ¥¤', 'â­', 'ðŸŽ®', 'ðŸ•', 'âœ¨', 'ðŸŽ¯', 'ðŸ’–'];
            const cardPairs = [...emojis, ...emojis].sort(() => Math.random() - 0.5);

            matchedPairs = 0;
            flippedCards = [];

            const gameArea = document.getElementById('game-area');
            gameArea.innerHTML = '<div id="memory-game-grid"></div>';
            const grid = document.getElementById('memory-game-grid');

            cardPairs.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.emoji = emoji;
                card.dataset.index = index;
                card.innerHTML = `
                    <span class="card-back">?</span>
                    <span class="card-front">${emoji}</span>
                `;
                card.onclick = () => flipCard(card);
                grid.appendChild(card);
            });
        }

        function flipCard(card) {
            if (flippedCards.length >= 2 || card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }

            card.classList.add('flipped');
            flippedCards.push(card);
            playSound('play');

            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 600);
            }
        }

        function checkMatch() {
            const [card1, card2] = flippedCards;

            if (card1.dataset.emoji === card2.dataset.emoji) {
                card1.classList.add('matched');
                card2.classList.add('matched');
                matchedPairs++;
                miniGameScore++;
                document.getElementById('game-score').textContent = miniGameScore;
                document.getElementById('game-time').textContent = `${matchedPairs}/8`;

                if (matchedPairs === 8) {
                    setTimeout(() => endMiniGame(), 500);
                }
            } else {
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
            }

            flippedCards = [];
        }

        // Settings
        function showSettings() {
            document.getElementById('settings-modal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.remove('active');
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-toggle').classList.toggle('active');
            saveState();
        }

        function toggleWeather() {
            weatherEnabled = !weatherEnabled;
            document.getElementById('weather-toggle').classList.toggle('active');
            if (!weatherEnabled) {
                document.getElementById('weather-effect').innerHTML = '';
            }
            saveState();
        }

        function toggleParticles() {
            particlesEnabled = !particlesEnabled;
            document.getElementById('particles-toggle').classList.toggle('active');
            saveState();
        }

        // Weather Effects
        function updateWeatherEffects() {
            if (!weatherEnabled) return;

            const weatherContainer = document.getElementById('weather-effect');
            const hour = new Date().getHours();

            // Determine weather based on time and randomness
            let newWeather = 'clear';
            if (hour >= 6 && hour < 9 && Math.random() < 0.3) {
                newWeather = 'rain';
            } else if (hour >= 18 && hour < 21 && Math.random() < 0.2) {
                newWeather = 'snow';
            }

            if (newWeather !== currentWeather) {
                currentWeather = newWeather;
                weatherContainer.innerHTML = '';

                if (currentWeather === 'rain') {
                    for (let i = 0; i < 20; i++) {
                        const drop = document.createElement('div');
                        drop.className = 'raindrop';
                        drop.style.left = Math.random() * 100 + '%';
                        drop.style.animationDelay = Math.random() * 1 + 's';
                        weatherContainer.appendChild(drop);
                    }
                } else if (currentWeather === 'snow') {
                    for (let i = 0; i < 15; i++) {
                        const flake = document.createElement('div');
                        flake.className = 'snowflake';
                        flake.textContent = 'â„ï¸';
                        flake.style.left = Math.random() * 100 + '%';
                        flake.style.animationDelay = Math.random() * 4 + 's';
                        flake.style.fontSize = (Math.random() * 1 + 0.5) + 'rem';
                        weatherContainer.appendChild(flake);
                    }
                }
            }
        }

        // Random Events
        const specialEvents = [
            {
                id: 'treasure',
                chance: 0.05,
                title: 'ðŸŽ TREASURE FOUND!',
                message: 'BULK FOUND A TREASURE! ALL STATS +20!',
                effect: () => {
                    hunger = Math.min(100, hunger + 20);
                    happiness = Math.min(100, happiness + 20);
                    cleanliness = Math.min(100, cleanliness + 20);
                }
            },
            {
                id: 'rainbow',
                chance: 0.03,
                title: 'ðŸŒˆ RAINBOW APPEARED!',
                message: 'A BEAUTIFUL RAINBOW! BULK IS INSPIRED! +30 HAPPINESS!',
                effect: () => {
                    happiness = Math.min(100, happiness + 30);
                    createParticles('#ff0000', 20);
                    createParticles('#ffd700', 20);
                    createParticles('#00ff00', 20);
                    createParticles('#0000ff', 20);
                    createParticles('#ff00ff', 20);
                }
            },
            {
                id: 'visitor',
                chance: 0.04,
                title: 'ðŸ‘‹ FRIEND VISITED!',
                message: 'A FRIEND CAME TO VISIT! BULK IS HAPPY! +25 HAPPINESS!',
                effect: () => {
                    happiness = Math.min(100, happiness + 25);
                    playJumpAnimation();
                }
            },
            {
                id: 'energy',
                chance: 0.06,
                title: 'âš¡ ENERGY BURST!',
                message: 'BULK FEELS ENERGIZED! +15 TO ALL STATS!',
                effect: () => {
                    hunger = Math.min(100, hunger + 15);
                    happiness = Math.min(100, happiness + 15);
                    cleanliness = Math.min(100, cleanliness + 15);
                    playSpinAnimation();
                }
            }
        ];

        function checkRandomEvents() {
            if (isDead || isSleeping || miniGameActive) return;

            const timeSinceLastEvent = Date.now() - lastEventTime;
            if (timeSinceLastEvent < 300000) return; // 5 minutes minimum between events

            for (const event of specialEvents) {
                if (Math.random() < event.chance) {
                    triggerEvent(event);
                    lastEventTime = Date.now();
                    break;
                }
            }
        }

        function triggerEvent(event) {
            const notification = document.getElementById('event-notification');
            notification.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 10px;">${event.title}</div>
                <div>${event.message}</div>
            `;
            notification.classList.add('active');

            event.effect();
            playSound('play');
            updateUI();
            saveState();

            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        // Dream System
        const dreamTypes = [
            { emoji: 'ðŸŒˆ', message: "BULK DREAMED OF RAINBOWS!", bonus: { happiness: 15, hunger: 5 } },
            { emoji: 'ðŸ•', message: "BULK DREAMED OF DELICIOUS FOOD!", bonus: { hunger: 20, happiness: 5 } },
            { emoji: 'ðŸŽ®', message: "BULK DREAMED OF PLAYING GAMES!", bonus: { happiness: 20 } },
            { emoji: 'ðŸ’œ', message: "BULK DREAMED OF YOU!", bonus: { happiness: 25, hunger: 5, cleanliness: 5 } },
            { emoji: 'ðŸš€', message: "BULK DREAMED OF SPACE ADVENTURE!", bonus: { happiness: 15, cleanliness: 10 } },
            { emoji: 'ðŸ†', message: "BULK DREAMED OF WINNING!", bonus: { happiness: 30 } },
            { emoji: 'ðŸŒŸ', message: "BULK HAD A MAGICAL DREAM!", bonus: { happiness: 20, hunger: 10, cleanliness: 10 } }
        ];

        function giveDream() {
            if (!isSleeping) return;

            const dream = dreamTypes[Math.floor(Math.random() * dreamTypes.length)];

            // Apply dream bonuses
            if (dream.bonus.happiness) happiness = Math.min(100, happiness + dream.bonus.happiness);
            if (dream.bonus.hunger) hunger = Math.min(100, hunger + dream.bonus.hunger);
            if (dream.bonus.cleanliness) cleanliness = Math.min(100, cleanliness + dream.bonus.cleanliness);

            // Create dream particles
            createDreamParticles();

            // Show dream message
            showMessage(`${dream.emoji} ${dream.message}`);
            playSound('play');

            // Give XP for caring
            addXP(15);

            // Achievement
            if (!achievements.dreamGiver) unlockAchievement('dreamGiver');

            // Hide button temporarily
            const btn = document.getElementById('dream-btn');
            btn.classList.remove('visible');
            setTimeout(() => {
                if (isSleeping) btn.classList.add('visible');
            }, 30000); // Can give another dream in 30 seconds

            updateUI();
            saveState();
        }

        function createDreamParticles() {
            const container = document.getElementById('scene-container');
            const dreamEmojis = ['âœ¨', 'â­', 'ðŸŒ™', 'ðŸ’«', 'â˜ï¸', 'ðŸ’œ'];

            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'dream-particle';
                particle.textContent = dreamEmojis[Math.floor(Math.random() * dreamEmojis.length)];
                particle.style.left = (20 + Math.random() * 60) + '%';
                particle.style.top = (30 + Math.random() * 40) + '%';
                particle.style.animationDelay = (Math.random() * 2) + 's';
                container.appendChild(particle);

                setTimeout(() => particle.remove(), 6000);
            }
        }

        // Level & XP System
        function addXP(amount) {
            xp += amount;
            const xpNeeded = getXPForLevel(level);

            while (xp >= xpNeeded) {
                xp -= xpNeeded;
                level++;
                showMessage(`ðŸŽ‰ LEVEL UP! NOW LEVEL ${level}! ðŸŽ‰`);
                createParticles('#ffd700', 50);
                playSound('play');

                // Unlock themes at certain levels
                updateThemeUnlocks();
            }

            updateLevelDisplay();
        }

        function getXPForLevel(lvl) {
            return 50 + (lvl * 25); // Increases each level
        }

        function updateLevelDisplay() {
            document.getElementById('level-num').textContent = level;
            const xpNeeded = getXPForLevel(level);
            const xpPercent = (xp / xpNeeded) * 100;
            document.getElementById('xp-bar').style.width = xpPercent + '%';
        }

        // Care Streak System
        function updateStreak() {
            const today = new Date().toDateString();

            if (lastCareDate === null) {
                careStreak = 1;
                lastCareDate = today;
            } else if (lastCareDate !== today) {
                const lastDate = new Date(lastCareDate);
                const todayDate = new Date(today);
                const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));

                if (diffDays === 1) {
                    careStreak++;
                    showMessage(`ðŸ”¥ ${careStreak} DAY STREAK! KEEP IT UP! ðŸ”¥`);
                } else if (diffDays > 1) {
                    careStreak = 1;
                    showMessage("STREAK RESET! START A NEW ONE! ðŸ’ª");
                }
                lastCareDate = today;
            }

            updateStreakDisplay();
            saveState();
        }

        function updateStreakDisplay() {
            const display = document.getElementById('streak-display');
            const numSpan = document.getElementById('streak-num');

            if (careStreak > 1) {
                display.classList.add('visible');
                numSpan.textContent = careStreak;
            } else {
                display.classList.remove('visible');
            }
        }

        // Thought Bubble System
        const thoughts = {
            happy: [
                "I LOVE MY LIFE! ðŸ’œ",
                "TODAY IS AMAZING!",
                "YOU'RE THE BEST!",
                "SO MUCH FUN!",
                "FEELING GREAT!"
            ],
            hungry: [
                "MY TUMMY RUMBLES...",
                "FOOD PLEASE?",
                "SO HUNGRY...",
                "NEED SCHMEG!"
            ],
            sad: [
                "I'M LONELY...",
                "PLAY WITH ME?",
                "FEELING DOWN...",
                "NEED ATTENTION..."
            ],
            dirty: [
                "I FEEL ICKY...",
                "NEED A BATH!",
                "SO DUSTY...",
                "CLEAN ME PLEASE?"
            ],
            sleeping: [
                "Zzz... ðŸ’¤",
                "Dreaming...",
                "So sleepy...",
                "Sweet dreams..."
            ],
            perfect: [
                "LIFE IS PERFECT!",
                "COULDN'T BE BETTER!",
                "I'M SO LUCKY!",
                "BEST DAY EVER!"
            ]
        };

        function showRandomThought() {
            if (isDead || miniGameActive) return;

            const now = Date.now();
            if (now - lastThoughtTime < 30000) return; // 30 second cooldown

            if (Math.random() > 0.3) return; // 30% chance

            let category = 'happy';
            const avgStats = (hunger + happiness + cleanliness) / 3;

            if (isSleeping) {
                category = 'sleeping';
            } else if (hunger === 100 && happiness === 100 && cleanliness === 100) {
                category = 'perfect';
            } else if (hunger < 30) {
                category = 'hungry';
            } else if (happiness < 30) {
                category = 'sad';
            } else if (cleanliness < 30) {
                category = 'dirty';
            } else if (avgStats > 60) {
                category = 'happy';
            }

            const thoughtList = thoughts[category];
            const thought = thoughtList[Math.floor(Math.random() * thoughtList.length)];

            const bubble = document.getElementById('thought-bubble');
            bubble.textContent = thought;
            bubble.classList.add('visible');

            lastThoughtTime = now;

            setTimeout(() => {
                bubble.classList.remove('visible');
            }, 3000);
        }

        // Visual Effects System
        function updateNeedsIndicators() {
            const hungerNeed = document.getElementById('need-hunger');
            const happyNeed = document.getElementById('need-happiness');
            const cleanNeed = document.getElementById('need-clean');
            const rumble = document.getElementById('rumble-lines');

            // Show indicators when stats are low
            hungerNeed.classList.toggle('visible', hunger < 30);
            happyNeed.classList.toggle('visible', happiness < 30);
            cleanNeed.classList.toggle('visible', cleanliness < 30);

            // Show rumble when very hungry
            rumble.classList.toggle('visible', hunger < 20);
        }

        function updateAura() {
            const aura = document.getElementById('bulk-aura');
            const halo = document.getElementById('perfect-halo');
            const avgStats = (hunger + happiness + cleanliness) / 3;
            const isPerfect = hunger === 100 && happiness === 100 && cleanliness === 100;

            // Reset classes
            aura.className = '';

            if (isPerfect) {
                aura.classList.add('perfect');
                halo.classList.add('visible');
            } else if (avgStats > 70) {
                aura.classList.add('happy');
                halo.classList.remove('visible');
            } else if (avgStats < 30) {
                aura.classList.add('sad');
                halo.classList.remove('visible');
            } else {
                halo.classList.remove('visible');
            }
        }

        function createBackgroundStars() {
            const container = document.getElementById('scene-container');

            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'bg-star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 60 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                star.style.animationDuration = (2 + Math.random() * 2) + 's';
                container.appendChild(star);
            }
        }

        function createSleepZZZ() {
            if (!isSleeping) return;

            const container = document.getElementById('scene-container');
            const zzz = document.createElement('div');
            zzz.className = 'sleep-zzz';
            zzz.textContent = 'Z';
            zzz.style.left = (40 + Math.random() * 20) + '%';
            zzz.style.top = '35%';
            zzz.style.animationDelay = Math.random() * 0.5 + 's';
            container.appendChild(zzz);

            setTimeout(() => zzz.remove(), 3000);
        }

        function createFloatingHeart() {
            if (isDead || isSleeping) return;
            if (happiness < 70) return;

            const container = document.getElementById('scene-container');
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.textContent = 'ðŸ’œ';
            heart.style.left = (40 + Math.random() * 20) + '%';
            heart.style.top = '50%';
            container.appendChild(heart);

            setTimeout(() => heart.remove(), 3000);
        }

        function createSparkleTrail(x, y) {
            if (!particlesEnabled) return;

            const container = document.getElementById('scene-container');
            const sparkleEmojis = ['âœ¨', 'â­', 'ðŸ’«', 'ðŸŒŸ'];

            for (let i = 0; i < 3; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.textContent = sparkleEmojis[Math.floor(Math.random() * sparkleEmojis.length)];
                sparkle.style.left = (x + (Math.random() - 0.5) * 30) + 'px';
                sparkle.style.top = (y + (Math.random() - 0.5) * 30) + 'px';
                sparkle.style.fontSize = (0.8 + Math.random() * 0.5) + 'rem';
                container.appendChild(sparkle);

                setTimeout(() => sparkle.remove(), 800);
            }
        }

        function showEmotionIndicators() {
            if (isDead || isSleeping) return;

            const container = document.getElementById('scene-container');

            // Remove old indicators
            container.querySelectorAll('.emotion-indicator').forEach(e => e.remove());

            // Add tears when sad
            if (happiness < 25) {
                const tear = document.createElement('div');
                tear.className = 'emotion-indicator tear';
                tear.textContent = 'ðŸ’§';
                container.appendChild(tear);

                setTimeout(() => tear.remove(), 5000);
            }

            // Add sweat when dirty
            if (cleanliness < 25) {
                const sweat = document.createElement('div');
                sweat.className = 'emotion-indicator sweat';
                sweat.textContent = 'ðŸ’¦';
                container.appendChild(sweat);

                setTimeout(() => sweat.remove(), 5000);
            }
        }

        // Theme System
        function setTheme(themeName) {
            const requiredLevel = {
                'default': 1,
                'sunset': 1,
                'ocean': 1,
                'forest': 5,
                'space': 10,
                'candy': 15
            };

            if (level < requiredLevel[themeName]) {
                showMessage(`UNLOCK AT LEVEL ${requiredLevel[themeName]}! ðŸ”’`);
                return;
            }

            currentTheme = themeName;

            // Update scene background
            const sceneContainer = document.getElementById('scene-container');
            sceneContainer.className = ''; // Clear classes
            sceneContainer.classList.add('theme-' + themeName);

            // Update button selection
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');

            saveState();
        }

        function updateThemeUnlocks() {
            const buttons = document.querySelectorAll('.theme-btn');
            const requiredLevels = [1, 1, 1, 5, 10, 15];

            buttons.forEach((btn, index) => {
                if (level >= requiredLevels[index]) {
                    btn.classList.remove('locked');
                }
            });
        }

        // Ambient Particles
        function createAmbientParticles() {
            if (isDead || isSleeping) return;

            const avgStats = (hunger + happiness + cleanliness) / 3;
            if (avgStats < 50) return; // Only show when Bulk is happy

            const container = document.getElementById('scene-container');
            const particle = document.createElement('div');
            particle.className = 'ambient-particle';

            // Choose emoji based on mood
            const emojis = avgStats > 80 ? ['âœ¨', 'â­', 'ðŸ’«', 'ðŸ’œ', 'ðŸ’–'] : ['âœ¨', 'â­'];
            particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];

            particle.style.left = Math.random() * 80 + 10 + '%';
            particle.style.top = Math.random() * 80 + 10 + '%';
            particle.style.animationDelay = Math.random() * 4 + 's';

            container.appendChild(particle);

            setTimeout(() => particle.remove(), 8000);
        }

        // Stat Milestone Celebrations
        let lastPerfectCheck = false;
        function checkStatMilestones() {
            const isPerfect = hunger === 100 && happiness === 100 && cleanliness === 100;

            // Big celebration when reaching perfect stats
            if (isPerfect && !lastPerfectCheck) {
                showMessage("ðŸŽ‰ PERFECT CARE! BULK IS SO HAPPY! ðŸŽ‰");
                createParticles('#ffd700', 80);
                createParticles('#ff00ff', 60);
                createParticles('#00ffff', 40);
                playJumpAnimation();
            }

            lastPerfectCheck = isPerfect;

            // Small sparkles for individual max stats
            if (hunger === 100 || happiness === 100 || cleanliness === 100) {
                if (Math.random() < 0.05) {
                    createParticles('#ffd700', 30);
                }
            }
        }

        // Enhanced save/load with achievements
        const originalLoadState = loadState;
        function loadState() {
            const saved = localStorage.getItem('bulkagachi');
            if (saved) {
                const state = JSON.parse(saved);
                hunger = state.hunger || 100;
                happiness = state.happiness || 100;
                cleanliness = state.cleanliness || 100;
                lastUpdateTime = state.lastUpdateTime || Date.now();
                birthTime = state.birthTime || Date.now();
                totalCareActions = state.totalCareActions || 0;
                isDead = state.isDead || false;
                achievements = state.achievements || {};
                soundEnabled = state.soundEnabled !== undefined ? state.soundEnabled : true;
                weatherEnabled = state.weatherEnabled !== undefined ? state.weatherEnabled : true;
                particlesEnabled = state.particlesEnabled !== undefined ? state.particlesEnabled : true;
                lastEventTime = state.lastEventTime || Date.now();
                level = state.level || 1;
                xp = state.xp || 0;
                careStreak = state.careStreak || 0;
                lastCareDate = state.lastCareDate || null;
                currentTheme = state.currentTheme || 'default';
                coins = state.coins || 0;
                ownedAccessories = state.ownedAccessories || [];
                equippedAccessory = state.equippedAccessory || null;
                poopCount = state.poopCount || 0;
                lastPoopTime = state.lastPoopTime || Date.now();
                poopUrgency = state.poopUrgency || 0;
                totalPoopsCleaned = state.totalPoopsCleaned || 0;
                goldenPoopsCleaned = state.goldenPoopsCleaned || 0;
                lastFeedTime = state.lastFeedTime || 0;
                isSick = state.isSick || false;
                ownedToys = state.ownedToys || [];
                learnedTricks = state.learnedTricks || [];
                lastFortuneDate = state.lastFortuneDate || null;
                lastVisitorTime = state.lastVisitorTime || 0;

                // Load new features
                if (state.lifeStats) lifeStats = { ...lifeStats, ...state.lifeStats };
                if (state.dailyQuests) dailyQuests = state.dailyQuests;
                if (state.lastQuestReset) lastQuestReset = state.lastQuestReset;
                if (state.ownedColors) ownedColors = state.ownedColors;
                if (state.bulkColor !== undefined) bulkColor = state.bulkColor;

                // Update sick indicator if sick
                if (isSick) {
                    document.getElementById('sick-indicator').classList.add('visible');
                    document.getElementById('medicine-btn').classList.add('visible');
                }

                // Update fortune button if already claimed today
                if (lastFortuneDate === new Date().toDateString()) {
                    document.getElementById('fortune-btn').classList.add('claimed');
                }

                // Update UI toggles
                if (!soundEnabled) document.getElementById('sound-toggle').classList.remove('active');
                if (!weatherEnabled) document.getElementById('weather-toggle').classList.remove('active');
                if (!particlesEnabled) document.getElementById('particles-toggle').classList.remove('active');

                // Update level display
                updateLevelDisplay();
                updateStreakDisplay();
                updateThemeUnlocks();
                updateCoinDisplay();
                updateAccessoryDisplay();

                // Restore poops if any
                const poopContainer = document.getElementById('poop-container');
                poopContainer.innerHTML = '';
                for (let i = 0; i < poopCount; i++) {
                    const poop = document.createElement('div');
                    poop.className = 'poop';
                    poop.textContent = 'ðŸ’©';
                    poop.dataset.type = 'normal';
                    poop.onclick = () => cleanPoop(poop);
                    poopContainer.appendChild(poop);
                }
                updateStinkLines();
                updatePoopMeter();
                updateFlies();

                // Apply saved theme
                if (currentTheme !== 'default') {
                    const sceneContainer = document.getElementById('scene-container');
                    sceneContainer.classList.add('theme-' + currentTheme);
                }

                // Calculate decay since last visit
                const timePassed = (Date.now() - lastUpdateTime) / 1000;
                const minutesPassed = timePassed / 60;

                if (!isDead) {
                    hunger = Math.max(0, hunger - minutesPassed * 2);
                    happiness = Math.max(0, happiness - minutesPassed * 1.5);
                    cleanliness = Math.max(0, cleanliness - minutesPassed * 1);
                }

                if (hunger === 0 && happiness === 0 && cleanliness === 0 && !isDead) {
                    isDead = true;
                    showRevivalScreen();
                }

                if (minutesPassed > 1 && !isDead) {
                    setTimeout(() => {
                        if (minutesPassed < 60) {
                            showMessage(`WELCOME BACK! YOU WERE GONE FOR ${Math.round(minutesPassed)} MIN! ðŸ‘‹`);
                        } else if (minutesPassed < 1440) {
                            showMessage(`WELCOME BACK! YOU WERE GONE FOR ${Math.round(minutesPassed / 60)} HOURS! ðŸ‘‹`);
                        } else {
                            showMessage(`WELCOME BACK! YOU WERE GONE FOR ${Math.round(minutesPassed / 1440)} DAYS! ðŸ‘‹`);
                        }
                    }, 1000);
                }
            } else {
                birthTime = Date.now();
                lastEventTime = Date.now();
                setTimeout(() => {
                    showMessage("HELLO! I'M BULK! TAKE CARE OF ME! ðŸ’œ");
                }, 1000);
            }
        }

        function saveState() {
            const state = {
                hunger,
                happiness,
                cleanliness,
                lastUpdateTime: Date.now(),
                birthTime,
                totalCareActions,
                isDead,
                achievements,
                soundEnabled,
                weatherEnabled,
                particlesEnabled,
                lastEventTime,
                level,
                xp,
                careStreak,
                lastCareDate,
                currentTheme,
                coins,
                ownedAccessories,
                equippedAccessory,
                poopCount,
                lastPoopTime,
                poopUrgency,
                totalPoopsCleaned,
                goldenPoopsCleaned,
                lastFeedTime,
                isSick,
                ownedToys,
                learnedTricks,
                lastFortuneDate,
                lastVisitorTime,
                lifeStats,
                dailyQuests,
                lastQuestReset,
                ownedColors,
                bulkColor
            };
            localStorage.setItem('bulkagachi', JSON.stringify(state));
        }

        // Coin System
        function addCoins(amount) {
            coins += amount;
            lifeStats.totalCoinsEarned += amount;
            updateCoinDisplay();

            // Create flying coin animation
            const container = document.getElementById('scene-container');
            const coin = document.createElement('div');
            coin.className = 'flying-coin';
            coin.textContent = 'ðŸª™';
            coin.style.left = '50%';
            coin.style.top = '50%';
            container.appendChild(coin);
            setTimeout(() => coin.remove(), 1000);

            saveState();
        }

        function updateCoinDisplay() {
            document.getElementById('coin-count').textContent = coins;
            const shopCoins = document.getElementById('shop-coins');
            if (shopCoins) shopCoins.textContent = coins;
        }

        // Shop System - Accessories with position types
        const shopItems = [
            { id: 'crown', icon: 'ðŸ‘‘', name: 'Royal Crown', price: 100, desc: 'For the king of pets!', pos: 'head' },
            { id: 'hat', icon: 'ðŸŽ©', name: 'Top Hat', price: 50, desc: 'Very distinguished!', pos: 'head' },
            { id: 'bow', icon: 'ðŸŽ€', name: 'Cute Bow', price: 30, desc: 'So adorable!', pos: 'head' },
            { id: 'glasses', icon: 'ðŸ•¶ï¸', name: 'Cool Shades', price: 40, desc: 'Too cool for school!', pos: 'face' },
            { id: 'halo', icon: 'ðŸ˜‡', name: 'Angel Halo', price: 75, desc: 'Pure and innocent!', pos: 'above' },
            { id: 'party', icon: 'ðŸŽ‰', name: 'Party Hat', price: 25, desc: 'Party time!', pos: 'head' },
            { id: 'flower', icon: 'ðŸŒ¸', name: 'Flower Crown', price: 60, desc: 'Spring vibes!', pos: 'head' },
            { id: 'star', icon: 'â­', name: 'Star Headband', price: 80, desc: 'You are a star!', pos: 'above' },
            { id: 'wizard', icon: 'ðŸ§™', name: 'Wizard Hat', price: 90, desc: 'Magical powers!', pos: 'head' },
            { id: 'chef', icon: 'ðŸ‘¨â€ðŸ³', name: 'Chef Hat', price: 45, desc: 'Master chef Bulk!', pos: 'head' }
        ];

        // Accessory position offsets (relative to Bulk's center)
        const accessoryPositions = {
            head: { top: '20%', scale: 1.5 },
            face: { top: '32%', scale: 1.3 },
            above: { top: '12%', scale: 1.2 }
        };

        function showShop() {
            const modal = document.getElementById('shop-modal');
            const itemsContainer = document.getElementById('shop-items');
            itemsContainer.innerHTML = '';

            document.getElementById('shop-coins').textContent = coins;

            shopItems.forEach(item => {
                const div = document.createElement('div');
                const owned = ownedAccessories.includes(item.id);
                const equipped = equippedAccessory === item.id;

                div.className = 'shop-item' + (equipped ? ' equipped' : (owned ? ' owned' : ''));
                div.innerHTML = `
                    <div class="shop-item-icon">${item.icon}</div>
                    <div class="shop-item-info">
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-price">${owned ? (equipped ? 'âœ“ EQUIPPED' : 'OWNED - TAP TO EQUIP') : item.price + ' ðŸª™'}</div>
                    </div>
                `;
                div.onclick = () => handleShopItem(item);
                itemsContainer.appendChild(div);
            });

            modal.classList.add('active');
        }

        function closeShop() {
            document.getElementById('shop-modal').classList.remove('active');
        }

        function handleShopItem(item) {
            if (ownedAccessories.includes(item.id)) {
                // Already owned - toggle equip
                if (equippedAccessory === item.id) {
                    equippedAccessory = null;
                    showMessage("ACCESSORY REMOVED! ðŸ‘‹");
                } else {
                    equippedAccessory = item.id;
                    showMessage(`${item.icon} EQUIPPED! LOOKING GOOD! âœ¨`);
                }
                updateAccessoryDisplay();
                showShop(); // Refresh shop display
                saveState();
            } else if (coins >= item.price) {
                // Buy item
                coins -= item.price;
                ownedAccessories.push(item.id);
                equippedAccessory = item.id;
                updateCoinDisplay();
                updateAccessoryDisplay();
                showMessage(`BOUGHT ${item.name}! ${item.icon}`);
                playSound('play');
                createParticles('#ffd700', 30);
                showShop(); // Refresh shop display
                saveState();
            } else {
                showMessage("NOT ENOUGH COINS! ðŸ’¸");
                playSadAnimation();
            }
        }

        function updateAccessoryDisplay() {
            const display = document.getElementById('accessory-display');
            if (equippedAccessory) {
                const item = shopItems.find(i => i.id === equippedAccessory);
                if (item) {
                    display.textContent = item.icon;
                    const pos = accessoryPositions[item.pos] || accessoryPositions.head;
                    display.style.top = pos.top;
                    display.style.fontSize = `${pos.scale * 2}rem`;
                } else {
                    display.textContent = '';
                }
            } else {
                display.textContent = '';
            }
        }

        // Enhanced Poop System
        function checkForPoop() {
            if (isDead || isSleeping) {
                hidePoopWarning();
                return;
            }

            // Urgency increases over time, especially after eating
            const timeSinceLastPoop = Date.now() - lastPoopTime;
            const timeSinceEating = Date.now() - lastFeedTime;

            // Base urgency increase
            if (timeSinceLastPoop > 30000) { // 30 seconds
                poopUrgency = Math.min(100, poopUrgency + 2);
            }

            // Extra urgency if recently ate
            if (timeSinceEating < 60000 && timeSinceEating > 0) {
                poopUrgency = Math.min(100, poopUrgency + 1);
            }

            updatePoopMeter();

            // Show warning when urgency is high
            if (poopUrgency >= 70 && poopUrgency < 90) {
                showPoopWarning();
            } else if (poopUrgency >= 90 && poopCount < 5) {
                // Time to poop!
                hidePoopWarning();
                addPoop();
                poopUrgency = 0;
            } else {
                hidePoopWarning();
            }

            updateStinkLines();
            updateFlies();
        }

        function showPoopWarning() {
            const warning = document.getElementById('poop-warning');
            warning.classList.add('visible');

            // Bulk squirms when needing to poop
            if (bulk && Math.random() < 0.3) {
                bulk.position.x = (Math.random() - 0.5) * 0.1;
                setTimeout(() => { if (bulk) bulk.position.x = 0; }, 200);
            }
        }

        function hidePoopWarning() {
            document.getElementById('poop-warning').classList.remove('visible');
        }

        function updatePoopMeter() {
            const meter = document.getElementById('poop-meter');
            const fill = document.getElementById('poop-meter-fill');

            if (poopUrgency > 30) {
                meter.classList.add('visible');
                fill.style.width = poopUrgency + '%';

                // Change color based on urgency
                if (poopUrgency >= 80) {
                    fill.style.background = 'linear-gradient(90deg, #ff4500, #ff0000)';
                } else if (poopUrgency >= 50) {
                    fill.style.background = 'linear-gradient(90deg, #daa520, #ff8c00)';
                } else {
                    fill.style.background = 'linear-gradient(90deg, #8b4513, #daa520)';
                }
            } else {
                meter.classList.remove('visible');
            }
        }

        function addPoop() {
            poopCount++;
            lastPoopTime = Date.now();

            const container = document.getElementById('poop-container');
            const poop = document.createElement('div');

            // Determine poop type
            const rand = Math.random();
            let poopType = 'normal';
            let poopEmoji = 'ðŸ’©';

            if (rand < 0.05) {
                // 5% chance for golden poop!
                poopType = 'golden';
                poopEmoji = 'ðŸ’©';
                poop.classList.add('golden');
                showMessage("âœ¨ WOW! A GOLDEN POOP! âœ¨");
                createParticles('#ffd700', 20);
            } else if (rand < 0.25) {
                // 20% chance for tiny poop
                poopType = 'tiny';
                poop.classList.add('tiny');
            }

            poop.className = 'poop' + (poopType !== 'normal' ? ' ' + poopType : '');
            poop.textContent = poopEmoji;
            poop.dataset.type = poopType;
            poop.onclick = () => cleanPoop(poop);
            container.appendChild(poop);

            // Reduce cleanliness when poop appears
            const cleanReduction = poopType === 'golden' ? 5 : (poopType === 'tiny' ? 5 : 10);
            cleanliness = Math.max(0, cleanliness - cleanReduction);

            // Show embarrassed face
            showEmbarrassedFace();

            // Create stink cloud
            createStinkCloud();

            updateUI();

            if (poopCount === 1 && poopType !== 'golden') {
                showMessage("UH OH... BULK MADE A MESS! ðŸ’©");
            } else if (poopCount >= 4) {
                showMessage("SO MUCH POOP! PLEASE CLEAN! ðŸ˜«");
            }

            saveState();
        }

        function showEmbarrassedFace() {
            const face = document.getElementById('embarrassed-face');
            face.classList.add('visible');
            setTimeout(() => face.classList.remove('visible'), 2000);
        }

        function createStinkCloud() {
            const container = document.getElementById('scene-container');
            const clouds = ['ðŸ’¨', 'â˜ï¸', 'ðŸ’­'];

            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const cloud = document.createElement('div');
                    cloud.className = 'stink-cloud';
                    cloud.textContent = clouds[Math.floor(Math.random() * clouds.length)];
                    cloud.style.left = (25 + Math.random() * 30) + '%';
                    cloud.style.bottom = '25%';
                    cloud.style.color = '#90ee90';
                    container.appendChild(cloud);
                    setTimeout(() => cloud.remove(), 2000);
                }, i * 300);
            }
        }

        function cleanPoop(poopElement) {
            const poopType = poopElement.dataset.type || 'normal';
            const rect = poopElement.getBoundingClientRect();
            const containerRect = document.getElementById('scene-container').getBoundingClientRect();

            // Show scoop animation
            const scoop = document.createElement('div');
            scoop.className = 'scoop-effect';
            scoop.textContent = 'ðŸ§¹';
            scoop.style.left = (rect.left - containerRect.left) + 'px';
            scoop.style.top = (rect.top - containerRect.top) + 'px';
            document.getElementById('scene-container').appendChild(scoop);
            setTimeout(() => scoop.remove(), 500);

            poopElement.style.animation = 'poopAppear 0.3s ease-out reverse';
            setTimeout(() => {
                poopElement.remove();
                poopCount--;
                totalPoopsCleaned++;

                // Reward based on poop type
                let coinReward = 2;
                let xpReward = 3;
                let cleanBonus = 5;
                let message = "POOP CLEANED! +2 ðŸª™";

                if (poopType === 'golden') {
                    coinReward = 15;
                    xpReward = 10;
                    cleanBonus = 10;
                    goldenPoopsCleaned++;
                    message = "âœ¨ GOLDEN POOP! +15 ðŸª™ âœ¨";
                    createParticles('#ffd700', 30);

                    // Achievement check
                    if (goldenPoopsCleaned >= 1 && !achievements.goldenPoop) {
                        unlockAchievement('goldenPoop');
                    }
                } else if (poopType === 'tiny') {
                    coinReward = 1;
                    xpReward = 2;
                    cleanBonus = 3;
                    message = "TINY POOP CLEANED! +1 ðŸª™";
                }

                cleanliness = Math.min(100, cleanliness + cleanBonus);
                addCoins(coinReward);
                addXP(xpReward);

                playSound('clean');
                createParticles('#00ffff', 10);
                showMessage(message);

                // Achievement for cleaning lots of poop
                if (totalPoopsCleaned >= 50 && !achievements.poopMaster) {
                    unlockAchievement('poopMaster');
                }

                // Track stats and quests
                lifeStats.totalPoops++;
                updateQuestProgress('poop');

                updateStinkLines();
                updateFlies();
                updateUI();
                saveState();
            }, 300);
        }

        function updateStinkLines() {
            const stink = document.getElementById('stink-lines');
            stink.classList.toggle('visible', poopCount >= 2);
        }

        function updateFlies() {
            const container = document.getElementById('flies-container');

            // Remove old flies
            container.innerHTML = '';

            // Add flies based on poop count
            if (poopCount >= 2) {
                const flyCount = Math.min(poopCount, 4);
                for (let i = 0; i < flyCount; i++) {
                    const fly = document.createElement('div');
                    fly.className = 'fly';
                    fly.textContent = 'ðŸª°';
                    fly.style.left = (20 + Math.random() * 40) + '%';
                    fly.style.bottom = (20 + Math.random() * 15) + '%';
                    fly.style.animationDelay = (Math.random() * 1) + 's';
                    fly.style.animationDuration = (0.8 + Math.random() * 0.4) + 's';
                    container.appendChild(fly);
                }
            }
        }

        // Sickness System
        function checkForSickness() {
            if (isDead || isSleeping || isSick) return;

            // Higher chance when stats are low or after too many poops
            const avgStats = (hunger + happiness + cleanliness) / 3;
            let sickChance = 0;

            if (avgStats < 30) sickChance += 0.02;
            if (poopCount >= 3) sickChance += 0.03;
            if (cleanliness < 20) sickChance += 0.02;

            if (Math.random() < sickChance) {
                makeBulkSick();
            }
        }

        function makeBulkSick() {
            isSick = true;
            sickTime = Date.now();

            document.getElementById('sick-indicator').classList.add('visible');
            document.getElementById('medicine-btn').classList.add('visible');

            showMessage("OH NO! BULK IS SICK! ðŸ¤’");
            playSound('clean'); // Sad sound

            // Sick Bulk moves slower
            if (bulk) {
                bulk.material && (bulk.material.color.setHex(0x90ee90)); // Greenish tint
            }

            // Stats decay faster when sick
            happiness = Math.max(0, happiness - 20);
            updateUI();
            saveState();
        }

        function giveMedicine() {
            if (!isSick) return;

            isSick = false;
            sickTime = 0;

            document.getElementById('sick-indicator').classList.remove('visible');
            document.getElementById('medicine-btn').classList.remove('visible');

            showMessage("ðŸ’Š ALL BETTER NOW! ðŸ’Š");
            playSound('play');
            createParticles('#ff69b4', 30);

            happiness = Math.min(100, happiness + 30);
            addXP(20);
            addCoins(5);

            // Achievement
            if (!achievements.doctor) unlockAchievement('doctor');

            updateUI();
            saveState();
        }

        // Toys System
        const toysList = [
            { id: 'ball', icon: 'âš½', name: 'Bouncy Ball', price: 20, happiness: 15 },
            { id: 'teddy', icon: 'ðŸ§¸', name: 'Teddy Bear', price: 35, happiness: 20 },
            { id: 'kite', icon: 'ðŸª', name: 'Flying Kite', price: 30, happiness: 18 },
            { id: 'robot', icon: 'ðŸ¤–', name: 'Robot Friend', price: 50, happiness: 25 },
            { id: 'car', icon: 'ðŸš—', name: 'Toy Car', price: 25, happiness: 15 },
            { id: 'drum', icon: 'ðŸ¥', name: 'Mini Drum', price: 40, happiness: 22 },
            { id: 'balloon', icon: 'ðŸŽˆ', name: 'Balloon', price: 10, happiness: 10 },
            { id: 'puzzle', icon: 'ðŸ§©', name: 'Puzzle', price: 45, happiness: 20 }
        ];

        function showToys() {
            const modal = document.getElementById('toys-modal');
            const itemsContainer = document.getElementById('toys-items');
            itemsContainer.innerHTML = '';

            document.getElementById('toys-coins').textContent = coins;

            toysList.forEach(toy => {
                const div = document.createElement('div');
                const owned = ownedToys.includes(toy.id);

                div.className = 'toy-item' + (owned ? ' owned' : '');
                div.innerHTML = `
                    <div class="shop-item-icon">${toy.icon}</div>
                    <div class="shop-item-info">
                        <div class="shop-item-name">${toy.name}</div>
                        <div class="shop-item-price">${owned ? 'TAP TO PLAY! +' + toy.happiness + ' ðŸ˜Š' : toy.price + ' ðŸª™'}</div>
                    </div>
                `;
                div.onclick = () => handleToyItem(toy);
                itemsContainer.appendChild(div);
            });

            modal.classList.add('active');
        }

        function closeToys() {
            document.getElementById('toys-modal').classList.remove('active');
        }

        function handleToyItem(toy) {
            if (ownedToys.includes(toy.id)) {
                // Play with toy
                playWithToy(toy);
                closeToys();
            } else if (coins >= toy.price) {
                // Buy toy
                coins -= toy.price;
                ownedToys.push(toy.id);
                updateCoinDisplay();
                showMessage(`BOUGHT ${toy.name}! ${toy.icon}`);
                playSound('play');
                createParticles('#ff69b4', 20);
                showToys(); // Refresh
                saveState();
            } else {
                showMessage("NOT ENOUGH COINS! ðŸ’¸");
            }
        }

        function playWithToy(toy) {
            if (isDead || isSleeping) return;

            activeToy = toy.id;
            showActiveToy(toy);

            happiness = Math.min(100, happiness + toy.happiness);
            addXP(8);
            addCoins(2);

            showMessage(`PLAYING WITH ${toy.name}! ${toy.icon}`);
            playSound('play');
            playHappyAnimation();

            // Track stats and quests
            lifeStats.toysPlayed++;
            updateQuestProgress('toy');

            // Remove toy after a while
            setTimeout(() => {
                hideActiveToy();
                activeToy = null;
            }, 5000);

            updateUI();
            saveState();
        }

        function showActiveToy(toy) {
            const display = document.getElementById('active-toy-display');
            display.innerHTML = `<div class="active-toy" style="left: 65%; bottom: 30%;">${toy.icon}</div>`;
        }

        function hideActiveToy() {
            document.getElementById('active-toy-display').innerHTML = '';
        }

        // Tricks System
        const tricksList = [
            { id: 'wave', icon: 'ðŸ‘‹', name: 'Wave', level: 1, xpReward: 10 },
            { id: 'spin', icon: 'ðŸ”„', name: 'Spin', level: 3, xpReward: 15 },
            { id: 'flip', icon: 'ðŸ¤¸', name: 'Backflip', level: 5, xpReward: 25 },
            { id: 'dance', icon: 'ðŸ’ƒ', name: 'Dance Move', level: 7, xpReward: 30 },
            { id: 'bow', icon: 'ðŸ™‡', name: 'Take a Bow', level: 2, xpReward: 12 },
            { id: 'jump', icon: 'â¬†ï¸', name: 'High Jump', level: 4, xpReward: 20 },
            { id: 'roll', icon: 'ðŸ”ƒ', name: 'Roll Over', level: 6, xpReward: 25 },
            { id: 'pose', icon: 'ðŸŒŸ', name: 'Star Pose', level: 10, xpReward: 40 }
        ];

        function showTricks() {
            const modal = document.getElementById('tricks-modal');
            const itemsContainer = document.getElementById('tricks-items');
            itemsContainer.innerHTML = '';

            tricksList.forEach(trick => {
                const div = document.createElement('div');
                const learned = learnedTricks.includes(trick.id);
                const canLearn = level >= trick.level;

                div.className = 'trick-item' + (learned ? ' learned' : (!canLearn ? ' locked' : ''));
                div.innerHTML = `
                    <div class="shop-item-icon">${trick.icon}</div>
                    <div class="shop-item-info">
                        <div class="shop-item-name">${trick.name}</div>
                        <div class="shop-item-price">${learned ? 'TAP TO PERFORM!' : (canLearn ? 'TAP TO LEARN!' : 'NEED LEVEL ' + trick.level)}</div>
                    </div>
                `;
                div.onclick = () => handleTrick(trick);
                itemsContainer.appendChild(div);
            });

            modal.classList.add('active');
        }

        function closeTricks() {
            document.getElementById('tricks-modal').classList.remove('active');
        }

        function handleTrick(trick) {
            const learned = learnedTricks.includes(trick.id);
            const canLearn = level >= trick.level;

            if (learned) {
                performTrick(trick);
                closeTricks();
            } else if (canLearn) {
                learnTrick(trick);
            } else {
                showMessage(`NEED LEVEL ${trick.level}! ðŸ”’`);
            }
        }

        function learnTrick(trick) {
            learnedTricks.push(trick.id);
            showMessage(`LEARNED ${trick.name}! ${trick.icon}`);
            playSound('play');
            createParticles('#ffd700', 40);
            addXP(trick.xpReward);

            // Track stats and quests
            lifeStats.tricksLearned++;
            updateQuestProgress('trick');

            if (!achievements.trickster && learnedTricks.length >= 3) {
                unlockAchievement('trickster');
            }

            showTricks(); // Refresh
            saveState();
        }

        function performTrick(trick) {
            if (isDead || isSleeping) return;

            showMessage(`${trick.icon} ${trick.name.toUpperCase()}! ${trick.icon}`);
            playSound('play');
            happiness = Math.min(100, happiness + 10);
            addXP(5);
            addCoins(3);

            // Perform animation based on trick
            switch(trick.id) {
                case 'wave':
                    if (bulk) {
                        let waveCount = 0;
                        const waveInt = setInterval(() => {
                            bulk.rotation.z = (waveCount % 2 === 0) ? 0.2 : -0.2;
                            waveCount++;
                            if (waveCount >= 6) {
                                clearInterval(waveInt);
                                bulk.rotation.z = 0;
                            }
                        }, 150);
                    }
                    break;
                case 'spin':
                    playSpinAnimation();
                    break;
                case 'flip':
                    if (bulk) {
                        let flipAngle = 0;
                        const flipInt = setInterval(() => {
                            flipAngle += Math.PI / 8;
                            bulk.rotation.x = flipAngle;
                            if (flipAngle >= Math.PI * 2) {
                                clearInterval(flipInt);
                                bulk.rotation.x = 0;
                            }
                        }, 50);
                    }
                    createParticles('#ff00ff', 30);
                    break;
                case 'dance':
                    makeBulkDance();
                    break;
                case 'bow':
                    if (bulk) {
                        bulk.rotation.x = 0.5;
                        setTimeout(() => { if (bulk) bulk.rotation.x = 0; }, 1000);
                    }
                    break;
                case 'jump':
                    playJumpAnimation();
                    playJumpAnimation();
                    break;
                case 'roll':
                    if (bulk) {
                        let rollAngle = 0;
                        const rollInt = setInterval(() => {
                            rollAngle += Math.PI / 6;
                            bulk.rotation.z = rollAngle;
                            if (rollAngle >= Math.PI * 2) {
                                clearInterval(rollInt);
                                bulk.rotation.z = 0;
                            }
                        }, 80);
                    }
                    break;
                case 'pose':
                    if (bulk) {
                        bulk.scale.set(1.3, 1.3, 1.3);
                        createParticles('#ffd700', 50);
                        setTimeout(() => { if (bulk) bulk.scale.set(1, 1, 1); }, 2000);
                    }
                    break;
            }

            updateUI();
            saveState();
        }

        // Fortune Cookie System
        const fortunes = [
            { text: "A purple friend brings great joy to your day!", lucky: "Lucky numbers: 7, 14, 21" },
            { text: "Good things come to those who care for others.", lucky: "Lucky color: Purple" },
            { text: "Your kindness will be rewarded tenfold.", lucky: "Lucky numbers: 3, 9, 27" },
            { text: "Today is a great day for new adventures!", lucky: "Lucky emoji: ðŸŒŸ" },
            { text: "Patience and love create the strongest bonds.", lucky: "Lucky time: Now!" },
            { text: "A golden opportunity awaits... perhaps a golden poop?", lucky: "Lucky numbers: 5, 15, 25" },
            { text: "Dance like nobody's watching - even if you're Bulk!", lucky: "Lucky color: Gold" },
            { text: "The best caretakers make the happiest pets.", lucky: "Lucky numbers: 1, 8, 88" },
            { text: "Expect the unexpected - a visitor may come soon!", lucky: "Lucky emoji: ðŸ’œ" },
            { text: "Clean spaces lead to happy places.", lucky: "Lucky numbers: 4, 12, 20" },
            { text: "Your dedication is noticed and appreciated.", lucky: "Lucky time: Midnight" },
            { text: "Every combo builds to something greater.", lucky: "Lucky numbers: 10, 100, 1000" }
        ];

        function openFortune() {
            const today = new Date().toDateString();

            if (lastFortuneDate === today) {
                showMessage("ALREADY CLAIMED TODAY! ðŸ¥ ");
                return;
            }

            lastFortuneDate = today;

            const fortune = fortunes[Math.floor(Math.random() * fortunes.length)];
            document.getElementById('fortune-text').textContent = `"${fortune.text}"`;
            document.getElementById('fortune-lucky').textContent = fortune.lucky;

            document.getElementById('fortune-modal').classList.add('active');
            document.getElementById('fortune-btn').classList.add('claimed');

            // Fortune bonus!
            addCoins(10);
            addXP(15);
            happiness = Math.min(100, happiness + 10);

            playSound('play');
            createParticles('#daa520', 25);

            // Track stats and quests
            lifeStats.fortunesRead++;
            updateQuestProgress('fortune');

            if (!achievements.fortunate) unlockAchievement('fortunate');

            updateUI();
            saveState();
        }

        function closeFortune() {
            document.getElementById('fortune-modal').classList.remove('active');
        }

        // Extras Menu
        function toggleExtrasMenu() {
            const panel = document.getElementById('extras-panel');
            panel.classList.toggle('active');
        }

        // Music System
        let musicPlaying = false;
        let backgroundMusic = null;
        const musicTracks = [
            { name: 'Calm Vibes', freq: 220, type: 'sine' },
            { name: 'Peaceful', freq: 196, type: 'sine' },
            { name: 'Dreamy', freq: 262, type: 'triangle' }
        ];

        function toggleMusic() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            if (musicPlaying) {
                stopMusic();
                showMessage('ðŸ”‡ MUSIC OFF');
            } else {
                playBackgroundMusic();
                showMessage('ðŸŽµ CALM MUSIC');
            }
            musicPlaying = !musicPlaying;
        }

        function playBackgroundMusic() {
            if (!audioContext) return;

            // Create a calming ambient sound
            const now = audioContext.currentTime;

            // Base drone
            const osc1 = audioContext.createOscillator();
            const gain1 = audioContext.createGain();
            osc1.type = 'sine';
            osc1.frequency.setValueAtTime(110, now);
            gain1.gain.setValueAtTime(0.05, now);
            osc1.connect(gain1);
            gain1.connect(audioContext.destination);

            // Harmony
            const osc2 = audioContext.createOscillator();
            const gain2 = audioContext.createGain();
            osc2.type = 'sine';
            osc2.frequency.setValueAtTime(165, now);
            gain2.gain.setValueAtTime(0.03, now);
            osc2.connect(gain2);
            gain2.connect(audioContext.destination);

            // High shimmer
            const osc3 = audioContext.createOscillator();
            const gain3 = audioContext.createGain();
            osc3.type = 'triangle';
            osc3.frequency.setValueAtTime(330, now);
            gain3.gain.setValueAtTime(0.02, now);
            osc3.connect(gain3);
            gain3.connect(audioContext.destination);

            osc1.start(now);
            osc2.start(now);
            osc3.start(now);

            backgroundMusic = { oscs: [osc1, osc2, osc3], gains: [gain1, gain2, gain3] };
        }

        function stopMusic() {
            if (backgroundMusic) {
                backgroundMusic.oscs.forEach(osc => {
                    try { osc.stop(); } catch(e) {}
                });
                backgroundMusic = null;
            }
        }

        // Life Stats System
        let lifeStats = {
            birthDate: Date.now(),
            totalFeedings: 0,
            totalPlays: 0,
            totalCleans: 0,
            totalSleeps: 0,
            totalPoops: 0,
            totalCoinsEarned: 0,
            longestCombo: 0,
            tricksLearned: 0,
            toysPlayed: 0,
            visitorsReceived: 0,
            fortunesRead: 0,
            daysAlive: 0,
            bathsGiven: 0,
            questsCompleted: 0
        };

        function showStats() {
            const modal = document.getElementById('stats-modal');
            const content = document.getElementById('stats-content');

            const daysAlive = Math.floor((Date.now() - lifeStats.birthDate) / (1000 * 60 * 60 * 24));
            const hoursAlive = Math.floor((Date.now() - lifeStats.birthDate) / (1000 * 60 * 60));

            content.innerHTML = `
                <div class="stat-card">
                    <div style="color: #ffd700; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">â° TIME ALIVE</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${daysAlive} days, ${hoursAlive % 24} hours</div>
                </div>
                <div class="stat-card">
                    <div style="color: #ff69b4; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">ðŸ” TOTAL FEEDINGS</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${lifeStats.totalFeedings}</div>
                </div>
                <div class="stat-card">
                    <div style="color: #00ffff; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">ðŸŽ® TOTAL PLAYS</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${lifeStats.totalPlays}</div>
                </div>
                <div class="stat-card">
                    <div style="color: #90ee90; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">ðŸ§¹ TOTAL CLEANS</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${lifeStats.totalCleans}</div>
                </div>
                <div class="stat-card">
                    <div style="color: #9b30ff; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">ðŸ˜´ TOTAL SLEEPS</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${lifeStats.totalSleeps}</div>
                </div>
                <div class="stat-card">
                    <div style="color: #ffa500; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">ðŸ”¥ LONGEST COMBO</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${lifeStats.longestCombo}x</div>
                </div>
                <div class="stat-card">
                    <div style="color: #ffff00; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">ðŸ’° COINS EARNED</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${lifeStats.totalCoinsEarned}</div>
                </div>
                <div class="stat-card">
                    <div style="color: #ff6b6b; font-size: clamp(0.6rem, 2.5vw, 0.8rem);">ðŸ“Š GROWTH STAGE</div>
                    <div style="color: #fff; font-size: clamp(0.5rem, 2vw, 0.7rem);">${growthStage.toUpperCase()}</div>
                </div>
            `;

            modal.classList.add('active');
        }

        function closeStats() {
            document.getElementById('stats-modal').classList.remove('active');
        }

        // Daily Quests System
        let dailyQuests = [];
        let lastQuestReset = 0;
        const questTemplates = [
            { id: 'feed3', task: 'Feed Bulk 3 times', target: 3, type: 'feed', reward: 20, emoji: 'ðŸ”' },
            { id: 'play3', task: 'Play with Bulk 3 times', target: 3, type: 'play', reward: 20, emoji: 'ðŸŽ®' },
            { id: 'clean2', task: 'Clean Bulk 2 times', target: 2, type: 'clean', reward: 15, emoji: 'ðŸ§¹' },
            { id: 'combo5', task: 'Get a 5x combo', target: 5, type: 'combo', reward: 30, emoji: 'ðŸ”¥' },
            { id: 'trick1', task: 'Teach a trick', target: 1, type: 'trick', reward: 25, emoji: 'ðŸŽª' },
            { id: 'toy2', task: 'Play with 2 toys', target: 2, type: 'toy', reward: 20, emoji: 'ðŸ§¸' },
            { id: 'fortune1', task: 'Read a fortune', target: 1, type: 'fortune', reward: 10, emoji: 'ðŸ¥ ' },
            { id: 'poop2', task: 'Clean up 2 poops', target: 2, type: 'poop', reward: 15, emoji: 'ðŸ’©' }
        ];

        function generateDailyQuests() {
            const today = new Date().setHours(0, 0, 0, 0);
            if (lastQuestReset >= today && dailyQuests.length > 0) return;

            lastQuestReset = today;
            dailyQuests = [];

            // Pick 3 random quests
            const shuffled = [...questTemplates].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 3; i++) {
                dailyQuests.push({
                    ...shuffled[i],
                    progress: 0,
                    completed: false,
                    claimed: false
                });
            }
        }

        function updateQuestProgress(type, amount = 1) {
            dailyQuests.forEach(quest => {
                if (quest.type === type && !quest.completed) {
                    // For combo quests, set progress to current combo (not cumulative)
                    if (type === 'combo') {
                        quest.progress = Math.min(quest.target, amount);
                    } else {
                        quest.progress = Math.min(quest.target, quest.progress + amount);
                    }
                    if (quest.progress >= quest.target) {
                        quest.completed = true;
                        showMessage('ðŸ“œ QUEST COMPLETE!');
                    }
                }
            });
        }

        function showQuests() {
            generateDailyQuests();
            const modal = document.getElementById('quests-modal');
            const content = document.getElementById('quests-content');

            content.innerHTML = dailyQuests.map(quest => `
                <div class="quest-item ${quest.completed ? 'completed' : ''} ${quest.claimed ? 'claimed' : ''}">
                    <div class="quest-header">
                        <span class="quest-title">${quest.emoji} ${quest.task}</span>
                        <span style="color: #ffd700; font-size: clamp(0.5rem, 2vw, 0.6rem);">+${quest.reward}ðŸ’°</span>
                    </div>
                    <div style="background: #333; border-radius: 5px; height: 10px; margin: 5px 0;">
                        <div style="background: ${quest.completed ? '#00ff00' : '#ff69b4'}; width: ${(quest.progress / quest.target) * 100}%; height: 100%; border-radius: 5px; transition: width 0.3s;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #aaa; font-size: clamp(0.4rem, 1.5vw, 0.5rem);">${quest.progress}/${quest.target}</span>
                        ${quest.completed && !quest.claimed ?
                            `<button onclick="claimQuestReward('${quest.id}')" style="background: #ffd700; color: #000; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: clamp(0.4rem, 1.5vw, 0.5rem);">CLAIM</button>` :
                            quest.claimed ? '<span style="color: #00ff00; font-size: clamp(0.4rem, 1.5vw, 0.5rem);">âœ“ CLAIMED</span>' : ''}
                    </div>
                </div>
            `).join('');

            modal.classList.add('active');
        }

        function claimQuestReward(questId) {
            const quest = dailyQuests.find(q => q.id === questId);
            if (quest && quest.completed && !quest.claimed) {
                quest.claimed = true;
                addCoins(quest.reward);
                showMessage(`+${quest.reward} ðŸ’° REWARD!`);
                playSound('buy');

                // Track quest completion
                lifeStats.questsCompleted++;
                if (lifeStats.questsCompleted >= 10 && !achievements.questHero) {
                    unlockAchievement('questHero');
                }

                showQuests(); // Refresh display
                saveState();
            }
        }

        function closeQuests() {
            document.getElementById('quests-modal').classList.remove('active');
        }

        // Color Customization System
        let bulkColor = null;
        const bulkColors = [
            { name: 'Default', color: null, price: 0 },
            { name: 'Pink', color: 0xff69b4, price: 50 },
            { name: 'Blue', color: 0x00bfff, price: 50 },
            { name: 'Green', color: 0x00ff00, price: 50 },
            { name: 'Gold', color: 0xffd700, price: 100 },
            { name: 'Purple', color: 0x9b30ff, price: 75 },
            { name: 'Red', color: 0xff4444, price: 50 },
            { name: 'Cyan', color: 0x00ffff, price: 75 },
            { name: 'Orange', color: 0xff8c00, price: 50 },
            { name: 'Rainbow', color: 'rainbow', price: 200 }
        ];
        let ownedColors = ['Default'];

        function showColorPicker() {
            const modal = document.getElementById('color-modal');
            const grid = document.getElementById('color-grid');

            grid.innerHTML = bulkColors.map(c => {
                const owned = ownedColors.includes(c.name);
                const selected = (bulkColor === c.color) || (bulkColor === null && c.color === null);
                const colorDisplay = c.color === 'rainbow' ?
                    'linear-gradient(90deg, red, orange, yellow, green, blue, purple)' :
                    c.color ? `#${c.color.toString(16).padStart(6, '0')}` : '#888';

                return `
                    <div class="color-option ${selected ? 'selected' : ''} ${!owned ? 'locked' : ''}"
                         onclick="${owned ? `selectColor('${c.name}')` : `buyColor('${c.name}')`}"
                         style="background: ${colorDisplay};">
                        <span style="background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 5px; font-size: clamp(0.4rem, 1.5vw, 0.5rem);">
                            ${c.name}${!owned ? ` (${c.price}ðŸ’°)` : selected ? ' âœ“' : ''}
                        </span>
                    </div>
                `;
            }).join('');

            modal.classList.add('active');
        }

        function selectColor(colorName) {
            const colorData = bulkColors.find(c => c.name === colorName);
            if (colorData && ownedColors.includes(colorName)) {
                bulkColor = colorData.color;
                applyBulkColor();
                showMessage(`ðŸŽ¨ ${colorName.toUpperCase()} SELECTED!`);
                showColorPicker(); // Refresh
            }
        }

        function buyColor(colorName) {
            const colorData = bulkColors.find(c => c.name === colorName);
            if (colorData && coins >= colorData.price) {
                coins -= colorData.price;
                ownedColors.push(colorName);
                updateUI();
                showMessage(`ðŸŽ¨ ${colorName.toUpperCase()} UNLOCKED!`);
                playSound('buy');

                // Color achievement
                if (ownedColors.length >= 5 && !achievements.colorful) {
                    unlockAchievement('colorful');
                }

                showColorPicker(); // Refresh
                saveState();
            } else {
                showMessage('NOT ENOUGH COINS!');
            }
        }

        function applyBulkColor() {
            if (!model) return;

            model.traverse((child) => {
                if (child.isMesh && child.material) {
                    if (bulkColor === null) {
                        // Reset to original
                        if (child.userData.originalColor) {
                            child.material.color.setHex(child.userData.originalColor);
                        }
                    } else if (bulkColor === 'rainbow') {
                        // Rainbow animation handled in animate loop
                    } else {
                        // Store original color if not stored
                        if (!child.userData.originalColor) {
                            child.userData.originalColor = child.material.color.getHex();
                        }
                        child.material.color.setHex(bulkColor);
                    }
                }
            });
        }

        function closeColorPicker() {
            document.getElementById('color-modal').classList.remove('active');
        }

        // Bath System
        let isBathing = false;

        function giveBath() {
            if (isDead || isSleeping || isBathing) {
                if (isSleeping) showMessage("SHHH! BULK IS SLEEPING! ðŸ’¤");
                return;
            }

            isBathing = true;

            // Show bath overlay
            const overlay = document.getElementById('bath-overlay');
            overlay.classList.add('active');

            // Create bubbles container
            let bubblesContainer = document.getElementById('bath-bubbles');
            if (!bubblesContainer) {
                bubblesContainer = document.createElement('div');
                bubblesContainer.id = 'bath-bubbles';
                document.getElementById('scene-container').appendChild(bubblesContainer);
            }

            // Generate bath bubbles
            const bubbleCount = 30;
            for (let i = 0; i < bubbleCount; i++) {
                setTimeout(() => {
                    if (!isBathing) return;
                    const bubble = document.createElement('div');
                    bubble.className = 'bath-bubble';
                    const size = 10 + Math.random() * 30;
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    bubble.style.left = `${Math.random() * 100}%`;
                    bubble.style.bottom = '0';
                    bubble.style.animationDuration = `${2 + Math.random() * 2}s`;
                    bubblesContainer.appendChild(bubble);
                    setTimeout(() => bubble.remove(), 4000);
                }, i * 100);
            }

            // Add sparkles
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    if (!isBathing) return;
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.textContent = 'âœ¨';
                    sparkle.style.left = `${20 + Math.random() * 60}%`;
                    sparkle.style.top = `${20 + Math.random() * 60}%`;
                    document.getElementById('scene-container').appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 1000);
                }, 500 + i * 150);
            }

            showMessage('ðŸ› BATH TIME! SPLISH SPLASH! ðŸ›');
            playSound('clean');
            playHappyAnimation();

            // Bath benefits
            cleanliness = 100;
            happiness = Math.min(100, happiness + 20);
            addXP(15);
            addCoins(5);

            // Track stats
            lifeStats.totalCleans++;
            lifeStats.bathsGiven++;
            updateQuestProgress('clean');

            // Bath achievement
            if (lifeStats.bathsGiven >= 10 && !achievements.bathLover) {
                unlockAchievement('bathLover');
            }

            // Remove any poops during bath
            if (poopCount > 0) {
                document.getElementById('poop-container').innerHTML = '';
                poopCount = 0;
                updateStinkLines();
                updateFlies();
            }

            // End bath after 3 seconds
            setTimeout(() => {
                overlay.classList.remove('active');
                bubblesContainer.innerHTML = '';
                isBathing = false;
                showMessage('âœ¨ SQUEAKY CLEAN! âœ¨');
                createParticles('#87ceeb', 40);
                updateUI();
                saveState();
            }, 3000);
        }

        // Memory Game System
        let memoryCards = [];
        let memoryFlipped = [];
        let memoryMoves = 0;
        let memoryPairs = 0;
        let memoryLocked = false;

        const memoryEmojis = ['ðŸ±', 'ðŸ¶', 'ðŸ°', 'ðŸ¦Š', 'ðŸ»', 'ðŸ¦‹', 'ðŸ¸', 'ðŸ¦„', 'ðŸŽ®', 'ðŸ•', 'â­', 'ðŸ’Ž'];

        function playMemoryGame() {
            if (isDead) return;

            memoryMoves = 0;
            memoryPairs = 0;
            memoryFlipped = [];
            memoryLocked = false;

            // Pick 6 random emojis and duplicate them
            const shuffledEmojis = [...memoryEmojis].sort(() => Math.random() - 0.5).slice(0, 6);
            memoryCards = [...shuffledEmojis, ...shuffledEmojis].sort(() => Math.random() - 0.5);

            const grid = document.getElementById('memory-grid');
            grid.innerHTML = memoryCards.map((emoji, index) => `
                <div class="memory-card" data-index="${index}" data-emoji="${emoji}" onclick="flipMemoryCard(${index})">
                    ?
                </div>
            `).join('');

            document.getElementById('memory-moves').textContent = '0';
            document.getElementById('memory-pairs').textContent = '0';
            document.getElementById('memory-game-modal').classList.add('active');
        }

        function flipMemoryCard(index) {
            if (memoryLocked) return;

            const card = document.querySelector(`.memory-card[data-index="${index}"]`);
            if (!card || card.classList.contains('flipped') || card.classList.contains('matched')) return;

            card.classList.add('flipped');
            card.textContent = memoryCards[index];
            memoryFlipped.push({ index, emoji: memoryCards[index] });

            if (memoryFlipped.length === 2) {
                memoryMoves++;
                document.getElementById('memory-moves').textContent = memoryMoves;
                memoryLocked = true;

                const [first, second] = memoryFlipped;

                if (first.emoji === second.emoji) {
                    // Match!
                    setTimeout(() => {
                        document.querySelector(`.memory-card[data-index="${first.index}"]`).classList.add('matched');
                        document.querySelector(`.memory-card[data-index="${second.index}"]`).classList.add('matched');
                        memoryPairs++;
                        document.getElementById('memory-pairs').textContent = memoryPairs;
                        playSound('play');

                        if (memoryPairs === 6) {
                            // Won!
                            setTimeout(() => {
                                const reward = Math.max(5, 30 - memoryMoves);
                                addCoins(reward);
                                addXP(20);
                                happiness = Math.min(100, happiness + 15);
                                showMessage(`ðŸ§  MEMORY MASTER! +${reward} ðŸª™`);

                                if (memoryMoves <= 12 && !achievements.memoryMaster) {
                                    unlockAchievement('memoryMaster');
                                }

                                closeMemoryGame();
                                updateUI();
                                saveState();
                            }, 500);
                        }

                        memoryFlipped = [];
                        memoryLocked = false;
                    }, 300);
                } else {
                    // No match
                    setTimeout(() => {
                        document.querySelector(`.memory-card[data-index="${first.index}"]`).classList.remove('flipped');
                        document.querySelector(`.memory-card[data-index="${first.index}"]`).textContent = '?';
                        document.querySelector(`.memory-card[data-index="${second.index}"]`).classList.remove('flipped');
                        document.querySelector(`.memory-card[data-index="${second.index}"]`).textContent = '?';
                        memoryFlipped = [];
                        memoryLocked = false;
                    }, 800);
                }
            }
        }

        function closeMemoryGame() {
            document.getElementById('memory-game-modal').classList.remove('active');
        }

        // Mood System - Facial expressions based on stats
        function updateMoodIndicator() {
            const indicator = document.getElementById('mood-indicator');
            if (!indicator) return;

            const avgStats = (hunger + happiness + cleanliness) / 3;

            let mood;
            if (isDead) {
                mood = 'ðŸ’€';
            } else if (isSleeping) {
                mood = 'ðŸ˜´';
            } else if (isSick) {
                mood = 'ðŸ¤¢';
            } else if (avgStats >= 90) {
                mood = 'ðŸ¥°';
            } else if (avgStats >= 75) {
                mood = 'ðŸ˜Š';
            } else if (avgStats >= 60) {
                mood = 'ðŸ™‚';
            } else if (avgStats >= 40) {
                mood = 'ðŸ˜';
            } else if (avgStats >= 25) {
                mood = 'ðŸ˜Ÿ';
            } else {
                mood = 'ðŸ˜¢';
            }

            // Add special moods
            if (!isDead && !isSleeping) {
                if (hunger < 20) mood = 'ðŸ¤¤'; // Hungry
                if (cleanliness < 20) mood = 'ðŸ¤®'; // Dirty
                if (poopCount >= 3) mood = 'ðŸ˜–'; // Too much poop
                if (hunger === 100 && happiness === 100 && cleanliness === 100) mood = 'ðŸ¤©'; // Perfect
            }

            indicator.textContent = mood;
        }

        // Visitor System
        const visitors = [
            { emoji: 'ðŸ±', name: 'Kitty', message: "Meow! You're doing great!", bonus: { happiness: 15 } },
            { emoji: 'ðŸ¶', name: 'Puppy', message: "Woof! Let's play!", bonus: { happiness: 20 } },
            { emoji: 'ðŸ°', name: 'Bunny', message: "Hop hop! Cute friend!", bonus: { happiness: 15 } },
            { emoji: 'ðŸ¦Š', name: 'Foxy', message: "What does the fox say?", bonus: { happiness: 18 } },
            { emoji: 'ðŸ»', name: 'Bear', message: "Bear hugs for Bulk!", bonus: { happiness: 25 } },
            { emoji: 'ðŸ¦‹', name: 'Butterfly', message: "So pretty!", bonus: { happiness: 12 } },
            { emoji: 'ðŸ¸', name: 'Froggy', message: "Ribbit! Nice to meet you!", bonus: { happiness: 15 } },
            { emoji: 'ðŸ¦„', name: 'Unicorn', message: "Magical visit!", bonus: { happiness: 30, coins: 10 } }
        ];

        function checkForVisitor() {
            if (isDead || isSleeping || currentVisitor) return;

            const timeSinceLastVisitor = Date.now() - lastVisitorTime;
            if (timeSinceLastVisitor < 180000) return; // 3 minutes minimum

            if (Math.random() < 0.05) { // 5% chance
                spawnVisitor();
            }
        }

        function spawnVisitor() {
            const visitor = visitors[Math.floor(Math.random() * visitors.length)];
            currentVisitor = visitor;
            lastVisitorTime = Date.now();

            const container = document.getElementById('visitor-container');
            container.innerHTML = `
                <div class="visitor">${visitor.emoji}</div>
                <div class="visitor-speech">${visitor.message}</div>
            `;
            container.classList.add('visible');

            showMessage(`${visitor.emoji} ${visitor.name.toUpperCase()} CAME TO VISIT!`);
            playSound('play');

            // Apply visitor bonus
            if (visitor.bonus.happiness) happiness = Math.min(100, happiness + visitor.bonus.happiness);
            if (visitor.bonus.coins) addCoins(visitor.bonus.coins);
            addXP(10);

            if (!achievements.socialButterfly) unlockAchievement('socialButterfly');

            updateUI();
            saveState();

            // Visitor leaves after a while
            setTimeout(() => {
                container.classList.remove('visible');
                currentVisitor = null;
                showMessage(`BYE BYE ${visitor.name.toUpperCase()}! ðŸ‘‹`);
            }, 15000);
        }

        // Random Idle Animations
        function playRandomIdleAnimation() {
            if (isDead || isSleeping || isDancing || !bulk) return;

            const rand = Math.random();

            if (rand < 0.2) {
                // Look around
                bulk.rotation.y = (Math.random() - 0.5) * 0.5;
                setTimeout(() => { if (bulk) bulk.rotation.y = 0; }, 1000);
            } else if (rand < 0.35) {
                // Little hop
                const origY = bulk.position.y;
                bulk.position.y = origY + 0.1;
                setTimeout(() => { if (bulk) bulk.position.y = origY; }, 200);
            } else if (rand < 0.45) {
                // Wiggle
                let wiggleCount = 0;
                const wiggleInt = setInterval(() => {
                    bulk.rotation.z = (wiggleCount % 2 === 0) ? 0.05 : -0.05;
                    wiggleCount++;
                    if (wiggleCount >= 4) {
                        clearInterval(wiggleInt);
                        bulk.rotation.z = 0;
                    }
                }, 100);
            } else if (rand < 0.55) {
                // Blink (scale eyes if visible)
                bulk.scale.y = 0.9;
                setTimeout(() => { if (bulk) bulk.scale.y = 1; }, 150);
            } else if (rand < 0.65) {
                // Stretch
                bulk.scale.set(0.9, 1.1, 0.9);
                setTimeout(() => { if (bulk) bulk.scale.set(1, 1, 1); }, 500);
            }
        }

        // Dance System
        function makeBulkDance() {
            if (isDead || isSleeping || isDancing) return;

            isDancing = true;
            happiness = Math.min(100, happiness + 10);
            addXP(5);
            addCoins(1);

            showMessage("ðŸ’ƒ DANCE PARTY! ðŸ•º");
            playSound('play');

            // Dance animation sequence
            let danceStep = 0;
            const danceInterval = setInterval(() => {
                if (danceStep >= 8) {
                    clearInterval(danceInterval);
                    isDancing = false;
                    bulk.rotation.y = 0;
                    bulk.position.x = 0;
                    bulk.scale.set(1, 1, 1);
                    return;
                }

                // Various dance moves
                switch(danceStep % 4) {
                    case 0: // Spin
                        bulk.rotation.y += Math.PI / 2;
                        createParticles('#ff00ff', 5);
                        break;
                    case 1: // Jump
                        bulk.position.y = 0.4 + 0.3;
                        setTimeout(() => { if (bulk) bulk.position.y = 0.4; }, 150);
                        break;
                    case 2: // Side step
                        bulk.position.x = (danceStep % 2 === 0) ? 0.3 : -0.3;
                        break;
                    case 3: // Wiggle
                        bulk.scale.set(1.1, 0.9, 1);
                        setTimeout(() => { if (bulk) bulk.scale.set(0.9, 1.1, 1); }, 100);
                        setTimeout(() => { if (bulk) bulk.scale.set(1, 1, 1); }, 200);
                        break;
                }

                danceStep++;
            }, 300);

            // Create dance floor effect
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    if (isDancing) {
                        const colors = ['#ff00ff', '#00ffff', '#ffd700', '#ff69b4', '#7fff00'];
                        createParticles(colors[Math.floor(Math.random() * colors.length)], 5);
                    }
                }, i * 150);
            }

            updateUI();
            saveState();
        }

        // Enhanced pet/tickle interaction
        function petBulk(x, y) {
            if (Math.random() < 0.3) {
                // Tickle!
                tickleBulk(x, y);
            } else {
                // Normal pet
                happiness = Math.min(100, happiness + 5);
                addCoins(1);
                playSound('play');
                playHappyAnimation();
                createFloatingEmoji('ðŸ’œ', x, y);
                showMessage("BULK LOVES PETS! ðŸ’œ");
            }
            updateCombo();
            addXP(2);
            updateUI();
            saveState();
        }

        function tickleBulk(x, y) {
            happiness = Math.min(100, happiness + 8);
            addCoins(2);

            // Create tickle text
            const container = document.getElementById('scene-container');
            const tickleTexts = ['Hehe!', 'Tee hee!', 'Ha ha!', 'Stop it!', 'Hahaha!'];
            const text = document.createElement('div');
            text.className = 'tickle-text';
            text.textContent = tickleTexts[Math.floor(Math.random() * tickleTexts.length)];
            text.style.left = x + 'px';
            text.style.top = y + 'px';
            container.appendChild(text);
            setTimeout(() => text.remove(), 1000);

            // Wiggle animation
            let wiggleCount = 0;
            const wiggleInterval = setInterval(() => {
                if (wiggleCount >= 6) {
                    clearInterval(wiggleInterval);
                    bulk.position.x = 0;
                    return;
                }
                bulk.position.x = (wiggleCount % 2 === 0) ? 0.1 : -0.1;
                wiggleCount++;
            }, 50);

            playSound('play');
            createFloatingEmoji('ðŸ˜†', x, y);
            showMessage("BULK IS TICKLISH! ðŸ˜‚");
        }

        // Add ambient particles periodically
        setInterval(() => {
            if (!isDead && !isSleeping && !miniGameActive) {
                createAmbientParticles();
                checkStatMilestones();
                checkAchievements();
                if (Math.random() < 0.3) createFloatingHeart();
            }
            if (isSleeping) createSleepZZZ();
            showRandomThought();
            updateAura();
            showEmotionIndicators();
            checkForPoop();
            checkForSickness();
            checkForVisitor();
            if (Math.random() < 0.15) playRandomIdleAnimation();
        }, 3000);

        // Create background stars on load
        setTimeout(createBackgroundStars, 1000);

        // Check weather and events periodically
        setInterval(() => {
            updateWeatherEffects();
            checkRandomEvents();
        }, 60000); // Every minute

        // Initial weather check
        setTimeout(() => {
            updateWeatherEffects();
        }, 2000);

        // Close extras panel when clicking outside
        document.addEventListener('click', (e) => {
            const extrasPanel = document.getElementById('extras-panel');
            const extrasBtn = document.getElementById('extras-menu-btn');
            if (extrasPanel.classList.contains('active') &&
                !extrasPanel.contains(e.target) &&
                !extrasBtn.contains(e.target)) {
                extrasPanel.classList.remove('active');
            }
        });

        // Initialize game
        init();
    </script>
</body>
</html>
